<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE WIDTH="100%" CLASS="hdft" CELLSPACING="0"><TR><TH CLASS="tl"><A HREF="http://emma.sourceforge.net/">EMMA</A> Coverage Report (generated Thu Nov 16 15:09:53 CET 2017)</TH></TR><TR><TD CLASS="nv">[<A HREF="../index.html">all classes</A>][<A HREF="38.html">org.apache.catalina.startup</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">ContextConfig.java</SPAN>]</H2><TABLE WIDTH="100%" CELLSPACING="0"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>ContextConfig.java</TD><TD CLASS="h">50%  (1/2)</TD><TD CLASS="h">6%   (2/32)</TD><TD CLASS="h">2%   (55/2586)</TD><TD CLASS="h">3%   (19/616)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE WIDTH="100%" CLASS="cn" CELLSPACING="0"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">ContextConfig$ContextErrorHandler</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#0">ContextConfig$ContextErrorHandler (ContextConfig): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">error (SAXParseException): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#3">fatalError (SAXParseException): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">warning (SAXParseException): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#5">ContextConfig</A></TD><TD>100% (1/1)</TD><TD CLASS="h">7%   (2/28)</TD><TD CLASS="h">2%   (55/2565)</TD><TD CLASS="h">3%   (19/609)</TD></TR><TR><TD CLASS="f"><A HREF="#6">antiLocking (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/180)</TD><TD CLASS="h">0%   (0/35)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#7">applicationAnnotationsConfig (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#8">applicationWebConfig (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/257)</TD><TD CLASS="h">0%   (0/62)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#9">authenticatorConfig (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/200)</TD><TD CLASS="h">0%   (0/65)</TD></TR><TR><TD CLASS="f"><A HREF="#a">beforeStart (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#b">contextConfig (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/67)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR><TD CLASS="f"><A HREF="#c">createContextDigester (): Digester</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#d">createWebXmlDigester (boolean, boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#e">defaultWebConfig (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/259)</TD><TD CLASS="h">0%   (0/59)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#f">destroy (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#10">fixDocBase (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/326)</TD><TD CLASS="h">0%   (0/67)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#11">getBaseDir (): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#12">getConfigBase (): File</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#13">getDefaultContextXml (): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#14">getDefaultWebXml (): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#15">getHostConfigPath (String): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/52)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR><TD CLASS="f"><A HREF="#16">init (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/47)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#17">lifecycleEvent (LifecycleEvent): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/70)</TD><TD CLASS="h">0%   (0/19)</TD></TR><TR><TD CLASS="f"><A HREF="#18">processContextConfig (File, String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/263)</TD><TD CLASS="h">0%   (0/60)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#19">processDefaultWebConfig (Digester, InputStream, InputSource): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/153)</TD><TD CLASS="h">0%   (0/36)</TD></TR><TR><TD CLASS="f"><A HREF="#1a">setCustomAuthenticators (Map): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1b">setDefaultContextXml (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#1c">setDefaultWebXml (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1d">start (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/94)</TD><TD CLASS="h">0%   (0/25)</TD></TR><TR><TD CLASS="f"><A HREF="#1e">stop (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/254)</TD><TD CLASS="h">0%   (0/45)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1f">validateSecurityRoles (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/124)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#20">&lt;static initializer&gt;</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (25/25)</TD><TD>100% (9/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#5">ContextConfig (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (30/30)</TD><TD>100% (10/10)</TD></TR></TABLE><P></P><TABLE WIDTH="100%" CLASS="s" CELLSPACING="0"><TR><TD CLASS="l">1</TD><TD>/*</TD></TR><TR><TD CLASS="l">2</TD><TD> * Licensed to the Apache Software Foundation (ASF) under one or more</TD></TR><TR><TD CLASS="l">3</TD><TD> * contributor license agreements.  See the NOTICE file distributed with</TD></TR><TR><TD CLASS="l">4</TD><TD> * this work for additional information regarding copyright ownership.</TD></TR><TR><TD CLASS="l">5</TD><TD> * The ASF licenses this file to You under the Apache License, Version 2.0</TD></TR><TR><TD CLASS="l">6</TD><TD> * (the &#34;License&#34;); you may not use this file except in compliance with</TD></TR><TR><TD CLASS="l">7</TD><TD> * the License.  You may obtain a copy of the License at</TD></TR><TR><TD CLASS="l">8</TD><TD> *</TD></TR><TR><TD CLASS="l">9</TD><TD> *      http://www.apache.org/licenses/LICENSE-2.0</TD></TR><TR><TD CLASS="l">10</TD><TD> *</TD></TR><TR><TD CLASS="l">11</TD><TD> * Unless required by applicable law or agreed to in writing, software</TD></TR><TR><TD CLASS="l">12</TD><TD> * distributed under the License is distributed on an &#34;AS IS&#34; BASIS,</TD></TR><TR><TD CLASS="l">13</TD><TD> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</TD></TR><TR><TD CLASS="l">14</TD><TD> * See the License for the specific language governing permissions and</TD></TR><TR><TD CLASS="l">15</TD><TD> * limitations under the License.</TD></TR><TR><TD CLASS="l">16</TD><TD> */</TD></TR><TR><TD CLASS="l">17</TD><TD>package org.apache.catalina.startup;</TD></TR><TR><TD CLASS="l">18</TD><TD> </TD></TR><TR><TD CLASS="l">19</TD><TD>import java.io.File;</TD></TR><TR><TD CLASS="l">20</TD><TD>import java.io.FileInputStream;</TD></TR><TR><TD CLASS="l">21</TD><TD>import java.io.FileNotFoundException;</TD></TR><TR><TD CLASS="l">22</TD><TD>import java.io.IOException;</TD></TR><TR><TD CLASS="l">23</TD><TD>import java.io.InputStream;</TD></TR><TR><TD CLASS="l">24</TD><TD>import java.net.URL;</TD></TR><TR><TD CLASS="l">25</TD><TD>import java.util.Map;</TD></TR><TR><TD CLASS="l">26</TD><TD>import java.util.Properties;</TD></TR><TR><TD CLASS="l">27</TD><TD> </TD></TR><TR><TD CLASS="l">28</TD><TD>import javax.servlet.ServletContext;</TD></TR><TR><TD CLASS="l">29</TD><TD> </TD></TR><TR><TD CLASS="l">30</TD><TD>import org.apache.catalina.Authenticator;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.apache.catalina.Container;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.apache.catalina.Context;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.apache.catalina.Engine;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.apache.catalina.Globals;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.apache.catalina.Host;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.apache.catalina.Lifecycle;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.apache.catalina.LifecycleEvent;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.apache.catalina.LifecycleListener;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.apache.catalina.Pipeline;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.apache.catalina.Valve;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.apache.catalina.Wrapper;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.apache.catalina.core.ContainerBase;</TD></TR><TR><TD CLASS="l">43</TD><TD>import org.apache.catalina.core.StandardContext;</TD></TR><TR><TD CLASS="l">44</TD><TD>import org.apache.catalina.core.StandardEngine;</TD></TR><TR><TD CLASS="l">45</TD><TD>import org.apache.catalina.core.StandardHost;</TD></TR><TR><TD CLASS="l">46</TD><TD>import org.apache.catalina.deploy.ErrorPage;</TD></TR><TR><TD CLASS="l">47</TD><TD>import org.apache.catalina.deploy.FilterDef;</TD></TR><TR><TD CLASS="l">48</TD><TD>import org.apache.catalina.deploy.FilterMap;</TD></TR><TR><TD CLASS="l">49</TD><TD>import org.apache.catalina.deploy.LoginConfig;</TD></TR><TR><TD CLASS="l">50</TD><TD>import org.apache.catalina.deploy.SecurityConstraint;</TD></TR><TR><TD CLASS="l">51</TD><TD>import org.apache.catalina.util.StringManager;</TD></TR><TR><TD CLASS="l">52</TD><TD>import org.apache.juli.logging.Log;</TD></TR><TR><TD CLASS="l">53</TD><TD>import org.apache.juli.logging.LogFactory;</TD></TR><TR><TD CLASS="l">54</TD><TD>import org.apache.tomcat.util.descriptor.DigesterFactory;</TD></TR><TR><TD CLASS="l">55</TD><TD>import org.apache.tomcat.util.descriptor.XmlErrorHandler;</TD></TR><TR><TD CLASS="l">56</TD><TD>import org.apache.tomcat.util.digester.Digester;</TD></TR><TR><TD CLASS="l">57</TD><TD>import org.apache.tomcat.util.digester.RuleSet;</TD></TR><TR><TD CLASS="l">58</TD><TD>import org.xml.sax.ErrorHandler;</TD></TR><TR><TD CLASS="l">59</TD><TD>import org.xml.sax.InputSource;</TD></TR><TR><TD CLASS="l">60</TD><TD>import org.xml.sax.SAXParseException;</TD></TR><TR><TD CLASS="l">61</TD><TD> </TD></TR><TR><TD CLASS="l">62</TD><TD>/**</TD></TR><TR><TD CLASS="l">63</TD><TD> * Startup event listener for a &lt;b&gt;Context&lt;/b&gt; that configures the properties</TD></TR><TR><TD CLASS="l">64</TD><TD> * of that Context, and the associated defined servlets.</TD></TR><TR><TD CLASS="l">65</TD><TD> *</TD></TR><TR><TD CLASS="l"><A NAME="5">66</A></TD><TD> * @author Craig R. McClanahan</TD></TR><TR><TD CLASS="l">67</TD><TD> * @author Jean-Francois Arcand</TD></TR><TR><TD CLASS="l"><A NAME="20">68</A></TD><TD> *</TD></TR><TR><TD CLASS="l">69</TD><TD> */</TD></TR><TR CLASS="c"><TD CLASS="l">70</TD><TD>public class ContextConfig implements LifecycleListener {</TD></TR><TR><TD CLASS="l">71</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">72</TD><TD>    protected static Log log = LogFactory.getLog( ContextConfig.class );</TD></TR><TR><TD CLASS="l">73</TD><TD> </TD></TR><TR><TD CLASS="l">74</TD><TD>    /**</TD></TR><TR><TD CLASS="l">75</TD><TD>     * The string resources for this package.</TD></TR><TR><TD CLASS="l">76</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">77</TD><TD>    protected static final StringManager sm =</TD></TR><TR CLASS="c"><TD CLASS="l">78</TD><TD>        StringManager.getManager(Constants.Package);</TD></TR><TR><TD CLASS="l">79</TD><TD> </TD></TR><TR><TD CLASS="l">80</TD><TD> </TD></TR><TR><TD CLASS="l">81</TD><TD>    // ----------------------------------------------------- Instance Variables</TD></TR><TR><TD CLASS="l">82</TD><TD> </TD></TR><TR><TD CLASS="l">83</TD><TD> </TD></TR><TR><TD CLASS="l">84</TD><TD>    /**</TD></TR><TR><TD CLASS="l">85</TD><TD>     * Custom mappings of login methods to authenticators</TD></TR><TR><TD CLASS="l">86</TD><TD>     */</TD></TR><TR><TD CLASS="l">87</TD><TD>    protected Map customAuthenticators;</TD></TR><TR><TD CLASS="l">88</TD><TD> </TD></TR><TR><TD CLASS="l">89</TD><TD> </TD></TR><TR><TD CLASS="l">90</TD><TD>    /**</TD></TR><TR><TD CLASS="l">91</TD><TD>     * The set of Authenticators that we know how to configure.  The key is</TD></TR><TR><TD CLASS="l">92</TD><TD>     * the name of the implemented authentication method, and the value is</TD></TR><TR><TD CLASS="l">93</TD><TD>     * the fully qualified Java class name of the corresponding Valve.</TD></TR><TR><TD CLASS="l">94</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">95</TD><TD>    protected static Properties authenticators = null;</TD></TR><TR><TD CLASS="l">96</TD><TD> </TD></TR><TR><TD CLASS="l">97</TD><TD> </TD></TR><TR><TD CLASS="l">98</TD><TD>    /**</TD></TR><TR><TD CLASS="l">99</TD><TD>     * The Context we are associated with.</TD></TR><TR><TD CLASS="l">100</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">101</TD><TD>    protected Context context = null;</TD></TR><TR><TD CLASS="l">102</TD><TD> </TD></TR><TR><TD CLASS="l">103</TD><TD> </TD></TR><TR><TD CLASS="l">104</TD><TD>    /**</TD></TR><TR><TD CLASS="l">105</TD><TD>     * The default web application's context file location.</TD></TR><TR><TD CLASS="l">106</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">107</TD><TD>    protected String defaultContextXml = null;</TD></TR><TR><TD CLASS="l">108</TD><TD> </TD></TR><TR><TD CLASS="l">109</TD><TD> </TD></TR><TR><TD CLASS="l">110</TD><TD>    /**</TD></TR><TR><TD CLASS="l">111</TD><TD>     * The default web application's deployment descriptor location.</TD></TR><TR><TD CLASS="l">112</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">113</TD><TD>    protected String defaultWebXml = null;</TD></TR><TR><TD CLASS="l">114</TD><TD> </TD></TR><TR><TD CLASS="l">115</TD><TD> </TD></TR><TR><TD CLASS="l">116</TD><TD>    /**</TD></TR><TR><TD CLASS="l">117</TD><TD>     * Track any fatal errors during startup configuration processing.</TD></TR><TR><TD CLASS="l">118</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">119</TD><TD>    protected boolean ok = false;</TD></TR><TR><TD CLASS="l">120</TD><TD> </TD></TR><TR><TD CLASS="l">121</TD><TD> </TD></TR><TR><TD CLASS="l">122</TD><TD>    /**</TD></TR><TR><TD CLASS="l">123</TD><TD>     * Any parse error which occurred while parsing XML descriptors.</TD></TR><TR><TD CLASS="l">124</TD><TD>     * @deprecated Unused. Will be removed in Tomcat 7.0.x.</TD></TR><TR><TD CLASS="l">125</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">126</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">127</TD><TD>    protected SAXParseException parseException = null;</TD></TR><TR><TD CLASS="l">128</TD><TD> </TD></TR><TR><TD CLASS="l">129</TD><TD> </TD></TR><TR><TD CLASS="l">130</TD><TD>    /**</TD></TR><TR><TD CLASS="l">131</TD><TD>     * Original docBase.</TD></TR><TR><TD CLASS="l">132</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">133</TD><TD>    protected String originalDocBase = null;</TD></TR><TR><TD CLASS="l">134</TD><TD> </TD></TR><TR><TD CLASS="l">135</TD><TD> </TD></TR><TR><TD CLASS="l">136</TD><TD>    /**</TD></TR><TR><TD CLASS="l">137</TD><TD>     * Anti-locking docBase. It is a path to a copy of the web application</TD></TR><TR><TD CLASS="l">138</TD><TD>     * in the java.io.tmpdir directory. This path is always an absolute one.</TD></TR><TR><TD CLASS="l">139</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">140</TD><TD>    private File antiLockingDocBase = null;</TD></TR><TR><TD CLASS="l">141</TD><TD> </TD></TR><TR><TD CLASS="l">142</TD><TD> </TD></TR><TR><TD CLASS="l">143</TD><TD>    /**</TD></TR><TR><TD CLASS="l">144</TD><TD>     * The &lt;code&gt;Digester&lt;/code&gt; we will use to process web application</TD></TR><TR><TD CLASS="l">145</TD><TD>     * context files.</TD></TR><TR><TD CLASS="l">146</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">147</TD><TD>    protected static Digester contextDigester = null;</TD></TR><TR><TD CLASS="l">148</TD><TD> </TD></TR><TR><TD CLASS="l">149</TD><TD> </TD></TR><TR><TD CLASS="l">150</TD><TD>    /**</TD></TR><TR><TD CLASS="l">151</TD><TD>     * The &lt;code&gt;Digester&lt;/code&gt; we will use to process web application</TD></TR><TR><TD CLASS="l">152</TD><TD>     * deployment descriptor files.</TD></TR><TR><TD CLASS="l">153</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">154</TD><TD>    protected Digester webDigester = null;</TD></TR><TR CLASS="c"><TD CLASS="l">155</TD><TD>    protected WebRuleSet webRuleSet = null;</TD></TR><TR><TD CLASS="l">156</TD><TD> </TD></TR><TR><TD CLASS="l">157</TD><TD>    /**</TD></TR><TR><TD CLASS="l">158</TD><TD>     * Attribute value used to turn on/off XML validation</TD></TR><TR><TD CLASS="l">159</TD><TD>     * @deprecated Unused. Will be removed in Tomcat 7.0.x.</TD></TR><TR><TD CLASS="l">160</TD><TD>     */</TD></TR><TR><TD CLASS="l">161</TD><TD>    @Deprecated</TD></TR><TR CLASS="c"><TD CLASS="l">162</TD><TD>    protected static boolean xmlValidation = false;</TD></TR><TR><TD CLASS="l">163</TD><TD> </TD></TR><TR><TD CLASS="l">164</TD><TD> </TD></TR><TR><TD CLASS="l">165</TD><TD>    /**</TD></TR><TR><TD CLASS="l">166</TD><TD>     * Attribute value used to turn on/off XML namespace awarenes.</TD></TR><TR><TD CLASS="l">167</TD><TD>     * @deprecated Unused. Will be removed in Tomcat 7.0.x.</TD></TR><TR><TD CLASS="l">168</TD><TD>     */</TD></TR><TR><TD CLASS="l">169</TD><TD>    @Deprecated</TD></TR><TR CLASS="c"><TD CLASS="l">170</TD><TD>    protected static boolean xmlNamespaceAware = false;</TD></TR><TR><TD CLASS="l">171</TD><TD> </TD></TR><TR><TD CLASS="l">172</TD><TD> </TD></TR><TR><TD CLASS="l">173</TD><TD>    /**</TD></TR><TR><TD CLASS="l">174</TD><TD>     * Deployment count.</TD></TR><TR><TD CLASS="l">175</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">176</TD><TD>    protected static long deploymentCount = 0L;</TD></TR><TR><TD CLASS="l">177</TD><TD> </TD></TR><TR><TD CLASS="l">178</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">179</TD><TD>    protected static final LoginConfig DUMMY_LOGIN_CONFIG =</TD></TR><TR><TD CLASS="l">180</TD><TD>                                new LoginConfig(&#34;NONE&#34;, null, null, null);</TD></TR><TR><TD CLASS="l">181</TD><TD> </TD></TR><TR><TD CLASS="l">182</TD><TD> </TD></TR><TR><TD CLASS="l">183</TD><TD>    // ------------------------------------------------------------- Properties</TD></TR><TR><TD CLASS="l"><A NAME="14">184</A></TD><TD>    /**</TD></TR><TR><TD CLASS="l">185</TD><TD>     * Return the location of the default deployment descriptor</TD></TR><TR><TD CLASS="l">186</TD><TD>     */</TD></TR><TR><TD CLASS="l">187</TD><TD>    public String getDefaultWebXml() {</TD></TR><TR CLASS="z"><TD CLASS="l">188</TD><TD>        if( defaultWebXml == null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">189</TD><TD>            defaultWebXml=Constants.DefaultWebXml;</TD></TR><TR><TD CLASS="l">190</TD><TD>        }</TD></TR><TR><TD CLASS="l">191</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">192</TD><TD>        return (this.defaultWebXml);</TD></TR><TR><TD CLASS="l">193</TD><TD> </TD></TR><TR><TD CLASS="l">194</TD><TD>    }</TD></TR><TR><TD CLASS="l">195</TD><TD> </TD></TR><TR><TD CLASS="l">196</TD><TD> </TD></TR><TR><TD CLASS="l">197</TD><TD>    /**</TD></TR><TR><TD CLASS="l">198</TD><TD>     * Set the location of the default deployment descriptor</TD></TR><TR><TD CLASS="l">199</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="1c">200</A></TD><TD>     * @param path Absolute/relative path to the default web.xml</TD></TR><TR><TD CLASS="l">201</TD><TD>     */</TD></TR><TR><TD CLASS="l">202</TD><TD>    public void setDefaultWebXml(String path) {</TD></TR><TR><TD CLASS="l">203</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>        this.defaultWebXml = path;</TD></TR><TR><TD CLASS="l">205</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>    }</TD></TR><TR><TD CLASS="l">207</TD><TD> </TD></TR><TR><TD CLASS="l">208</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="13">209</A></TD><TD>    /**</TD></TR><TR><TD CLASS="l">210</TD><TD>     * Return the location of the default context file</TD></TR><TR><TD CLASS="l">211</TD><TD>     */</TD></TR><TR><TD CLASS="l">212</TD><TD>    public String getDefaultContextXml() {</TD></TR><TR CLASS="z"><TD CLASS="l">213</TD><TD>        if( defaultContextXml == null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">214</TD><TD>            defaultContextXml=Constants.DefaultContextXml;</TD></TR><TR><TD CLASS="l">215</TD><TD>        }</TD></TR><TR><TD CLASS="l">216</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">217</TD><TD>        return (this.defaultContextXml);</TD></TR><TR><TD CLASS="l">218</TD><TD> </TD></TR><TR><TD CLASS="l">219</TD><TD>    }</TD></TR><TR><TD CLASS="l">220</TD><TD> </TD></TR><TR><TD CLASS="l">221</TD><TD> </TD></TR><TR><TD CLASS="l">222</TD><TD>    /**</TD></TR><TR><TD CLASS="l">223</TD><TD>     * Set the location of the default context file</TD></TR><TR><TD CLASS="l">224</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="1b">225</A></TD><TD>     * @param path Absolute/relative path to the default context.xml</TD></TR><TR><TD CLASS="l">226</TD><TD>     */</TD></TR><TR><TD CLASS="l">227</TD><TD>    public void setDefaultContextXml(String path) {</TD></TR><TR><TD CLASS="l">228</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">229</TD><TD>        this.defaultContextXml = path;</TD></TR><TR><TD CLASS="l">230</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">231</TD><TD>    }</TD></TR><TR><TD CLASS="l">232</TD><TD> </TD></TR><TR><TD CLASS="l">233</TD><TD> </TD></TR><TR><TD CLASS="l">234</TD><TD>    /**</TD></TR><TR><TD CLASS="l">235</TD><TD>     * Sets custom mappings of login methods to authenticators.</TD></TR><TR><TD CLASS="l">236</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="1a">237</A></TD><TD>     * @param customAuthenticators Custom mappings of login methods to</TD></TR><TR><TD CLASS="l">238</TD><TD>     * authenticators</TD></TR><TR><TD CLASS="l">239</TD><TD>     */</TD></TR><TR><TD CLASS="l">240</TD><TD>    public void setCustomAuthenticators(Map customAuthenticators) {</TD></TR><TR CLASS="z"><TD CLASS="l">241</TD><TD>        this.customAuthenticators = customAuthenticators;</TD></TR><TR CLASS="z"><TD CLASS="l">242</TD><TD>    }</TD></TR><TR><TD CLASS="l">243</TD><TD> </TD></TR><TR><TD CLASS="l">244</TD><TD> </TD></TR><TR><TD CLASS="l">245</TD><TD>    // --------------------------------------------------------- Public Methods</TD></TR><TR><TD CLASS="l">246</TD><TD> </TD></TR><TR><TD CLASS="l">247</TD><TD> </TD></TR><TR><TD CLASS="l">248</TD><TD>    /**</TD></TR><TR><TD CLASS="l">249</TD><TD>     * Process events for an associated Context.</TD></TR><TR><TD CLASS="l">250</TD><TD>     *</TD></TR><TR><TD CLASS="l">251</TD><TD>     * @param event The lifecycle event that has occurred</TD></TR><TR><TD CLASS="l">252</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="17">253</A></TD><TD>    public void lifecycleEvent(LifecycleEvent event) {</TD></TR><TR><TD CLASS="l">254</TD><TD> </TD></TR><TR><TD CLASS="l">255</TD><TD>        // Identify the context we are associated with</TD></TR><TR><TD CLASS="l">256</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">257</TD><TD>            context = (Context) event.getLifecycle();</TD></TR><TR CLASS="z"><TD CLASS="l">258</TD><TD>        } catch (ClassCastException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">259</TD><TD>            log.error(sm.getString(&#34;contextConfig.cce&#34;, event.getLifecycle()), e);</TD></TR><TR CLASS="z"><TD CLASS="l">260</TD><TD>            return;</TD></TR><TR CLASS="z"><TD CLASS="l">261</TD><TD>        }</TD></TR><TR><TD CLASS="l">262</TD><TD> </TD></TR><TR><TD CLASS="l">263</TD><TD>        // Process the event that has occurred</TD></TR><TR CLASS="z"><TD CLASS="l">264</TD><TD>        if (event.getType().equals(Lifecycle.START_EVENT)) {</TD></TR><TR CLASS="z"><TD CLASS="l">265</TD><TD>            start();</TD></TR><TR CLASS="z"><TD CLASS="l">266</TD><TD>        } else if (event.getType().equals(StandardContext.BEFORE_START_EVENT)) {</TD></TR><TR CLASS="z"><TD CLASS="l">267</TD><TD>            beforeStart();</TD></TR><TR CLASS="z"><TD CLASS="l">268</TD><TD>        } else if (event.getType().equals(StandardContext.AFTER_START_EVENT)) {</TD></TR><TR><TD CLASS="l">269</TD><TD>            // Restore docBase for management tools</TD></TR><TR CLASS="z"><TD CLASS="l">270</TD><TD>            if (originalDocBase != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">271</TD><TD>                context.setDocBase(originalDocBase);</TD></TR><TR><TD CLASS="l">272</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">273</TD><TD>        } else if (event.getType().equals(Lifecycle.STOP_EVENT)) {</TD></TR><TR CLASS="z"><TD CLASS="l">274</TD><TD>            stop();</TD></TR><TR CLASS="z"><TD CLASS="l">275</TD><TD>        } else if (event.getType().equals(Lifecycle.INIT_EVENT)) {</TD></TR><TR CLASS="z"><TD CLASS="l">276</TD><TD>            init();</TD></TR><TR CLASS="z"><TD CLASS="l">277</TD><TD>        } else if (event.getType().equals(Lifecycle.DESTROY_EVENT)) {</TD></TR><TR CLASS="z"><TD CLASS="l">278</TD><TD>            destroy();</TD></TR><TR><TD CLASS="l">279</TD><TD>        }</TD></TR><TR><TD CLASS="l">280</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">281</TD><TD>    }</TD></TR><TR><TD CLASS="l">282</TD><TD> </TD></TR><TR><TD CLASS="l">283</TD><TD> </TD></TR><TR><TD CLASS="l">284</TD><TD>    // -------------------------------------------------------- protected Methods</TD></TR><TR><TD CLASS="l">285</TD><TD> </TD></TR><TR><TD CLASS="l">286</TD><TD> </TD></TR><TR><TD CLASS="l">287</TD><TD>    /**</TD></TR><TR><TD CLASS="l"><A NAME="7">288</A></TD><TD>     * Process the application classes annotations, if it exists.</TD></TR><TR><TD CLASS="l">289</TD><TD>     */</TD></TR><TR><TD CLASS="l">290</TD><TD>    protected void applicationAnnotationsConfig() {</TD></TR><TR><TD CLASS="l">291</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">292</TD><TD>        long t1=System.currentTimeMillis();</TD></TR><TR><TD CLASS="l">293</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">294</TD><TD>        WebAnnotationSet.loadApplicationAnnotations(context);</TD></TR><TR><TD CLASS="l">295</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">296</TD><TD>        long t2=System.currentTimeMillis();</TD></TR><TR CLASS="z"><TD CLASS="l">297</TD><TD>        if (context instanceof StandardContext) {</TD></TR><TR CLASS="z"><TD CLASS="l">298</TD><TD>            ((StandardContext) context).setStartupTime(t2-t1+</TD></TR><TR CLASS="z"><TD CLASS="l">299</TD><TD>                    ((StandardContext) context).getStartupTime());</TD></TR><TR><TD CLASS="l">300</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">301</TD><TD>    }</TD></TR><TR><TD CLASS="l">302</TD><TD> </TD></TR><TR><TD CLASS="l">303</TD><TD> </TD></TR><TR><TD CLASS="l">304</TD><TD>    /**</TD></TR><TR><TD CLASS="l"><A NAME="8">305</A></TD><TD>     * Process the application configuration file, if it exists.</TD></TR><TR><TD CLASS="l">306</TD><TD>     */</TD></TR><TR><TD CLASS="l">307</TD><TD>    protected void applicationWebConfig() {</TD></TR><TR><TD CLASS="l">308</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">309</TD><TD>        String altDDName = null;</TD></TR><TR><TD CLASS="l">310</TD><TD> </TD></TR><TR><TD CLASS="l">311</TD><TD>        // Open the application web.xml file, if it exists</TD></TR><TR CLASS="z"><TD CLASS="l">312</TD><TD>        InputStream stream = null;</TD></TR><TR CLASS="z"><TD CLASS="l">313</TD><TD>        ServletContext servletContext = context.getServletContext();</TD></TR><TR CLASS="z"><TD CLASS="l">314</TD><TD>        if (servletContext != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">315</TD><TD>            altDDName = (String)servletContext.getAttribute(</TD></TR><TR><TD CLASS="l">316</TD><TD>                                                        Globals.ALT_DD_ATTR);</TD></TR><TR CLASS="z"><TD CLASS="l">317</TD><TD>            if (altDDName != null) {</TD></TR><TR><TD CLASS="l">318</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">319</TD><TD>                    stream = new FileInputStream(altDDName);</TD></TR><TR CLASS="z"><TD CLASS="l">320</TD><TD>                } catch (FileNotFoundException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">321</TD><TD>                    log.error(sm.getString(&#34;contextConfig.altDDNotFound&#34;,</TD></TR><TR><TD CLASS="l">322</TD><TD>                                           altDDName));</TD></TR><TR CLASS="z"><TD CLASS="l">323</TD><TD>                }</TD></TR><TR><TD CLASS="l">324</TD><TD>            }</TD></TR><TR><TD CLASS="l">325</TD><TD>            else {</TD></TR><TR CLASS="z"><TD CLASS="l">326</TD><TD>                stream = servletContext.getResourceAsStream</TD></TR><TR CLASS="z"><TD CLASS="l">327</TD><TD>                    (Constants.ApplicationWebXml);</TD></TR><TR><TD CLASS="l">328</TD><TD>            }</TD></TR><TR><TD CLASS="l">329</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">330</TD><TD>        if (stream == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">331</TD><TD>            if (log.isDebugEnabled()) {</TD></TR><TR CLASS="z"><TD CLASS="l">332</TD><TD>                log.debug(sm.getString(&#34;contextConfig.applicationMissing&#34;) + &#34; &#34; + context);</TD></TR><TR><TD CLASS="l">333</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">334</TD><TD>            return;</TD></TR><TR><TD CLASS="l">335</TD><TD>        }</TD></TR><TR><TD CLASS="l">336</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">337</TD><TD>        long t1=System.currentTimeMillis();</TD></TR><TR><TD CLASS="l">338</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">339</TD><TD>        URL url=null;</TD></TR><TR><TD CLASS="l">340</TD><TD>        // Process the application web.xml file</TD></TR><TR CLASS="z"><TD CLASS="l">341</TD><TD>        synchronized (webDigester) {</TD></TR><TR><TD CLASS="l">342</TD><TD>            try {</TD></TR><TR CLASS="z"><TD CLASS="l">343</TD><TD>                if (altDDName != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">344</TD><TD>                    url = new File(altDDName).toURL();</TD></TR><TR><TD CLASS="l">345</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">346</TD><TD>                    url = servletContext.getResource(</TD></TR><TR><TD CLASS="l">347</TD><TD>                                                Constants.ApplicationWebXml);</TD></TR><TR><TD CLASS="l">348</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">349</TD><TD>                if( url!=null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">350</TD><TD>                    InputSource is = new InputSource(url.toExternalForm());</TD></TR><TR CLASS="z"><TD CLASS="l">351</TD><TD>                    is.setByteStream(stream);</TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>                    if (context instanceof StandardContext) {</TD></TR><TR CLASS="z"><TD CLASS="l">353</TD><TD>                        ((StandardContext) context).setReplaceWelcomeFiles(true);</TD></TR><TR><TD CLASS="l">354</TD><TD>                    }</TD></TR><TR><TD CLASS="l">355</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">356</TD><TD>                    XmlErrorHandler handler = new XmlErrorHandler();</TD></TR><TR><TD CLASS="l">357</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">358</TD><TD>                    webDigester.push(context);</TD></TR><TR CLASS="z"><TD CLASS="l">359</TD><TD>                    webDigester.setErrorHandler(handler);</TD></TR><TR><TD CLASS="l">360</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">361</TD><TD>                    if(log.isDebugEnabled()) {</TD></TR><TR CLASS="z"><TD CLASS="l">362</TD><TD>                        log.debug(&#34;Parsing application web.xml file at &#34; + url.toExternalForm());</TD></TR><TR><TD CLASS="l">363</TD><TD>                    }</TD></TR><TR><TD CLASS="l">364</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">365</TD><TD>                    webDigester.parse(is);</TD></TR><TR><TD CLASS="l">366</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">367</TD><TD>                    if (handler.getWarnings().size() &gt; 0 ||</TD></TR><TR CLASS="z"><TD CLASS="l">368</TD><TD>                            handler.getErrors().size() &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">369</TD><TD>                        ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">370</TD><TD>                        handler.logFindings(log, is.getSystemId());</TD></TR><TR><TD CLASS="l">371</TD><TD>                    }</TD></TR><TR CLASS="z"><TD CLASS="l">372</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">373</TD><TD>                    log.info(&#34;No web.xml, using defaults &#34; + context );</TD></TR><TR><TD CLASS="l">374</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">375</TD><TD>            } catch (SAXParseException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">376</TD><TD>                log.error(sm.getString(&#34;contextConfig.applicationParse&#34;, url.toExternalForm()), e);</TD></TR><TR CLASS="z"><TD CLASS="l">377</TD><TD>                log.error(sm.getString(&#34;contextConfig.applicationPosition&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">378</TD><TD>                                 &#34;&#34; + e.getLineNumber(),</TD></TR><TR CLASS="z"><TD CLASS="l">379</TD><TD>                                 &#34;&#34; + e.getColumnNumber()));</TD></TR><TR CLASS="z"><TD CLASS="l">380</TD><TD>                ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">381</TD><TD>            } catch (Exception e) {</TD></TR><TR CLASS="z"><TD CLASS="l">382</TD><TD>                log.error(sm.getString(&#34;contextConfig.applicationParse&#34;, url.toExternalForm()), e);</TD></TR><TR CLASS="z"><TD CLASS="l">383</TD><TD>                ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">384</TD><TD>            } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">385</TD><TD>                webDigester.reset();</TD></TR><TR><TD CLASS="l">386</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">387</TD><TD>                    if (stream != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">388</TD><TD>                        stream.close();</TD></TR><TR><TD CLASS="l">389</TD><TD>                    }</TD></TR><TR CLASS="z"><TD CLASS="l">390</TD><TD>                } catch (IOException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">391</TD><TD>                    log.error(sm.getString(&#34;contextConfig.applicationClose&#34;), e);</TD></TR><TR CLASS="z"><TD CLASS="l">392</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">393</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">394</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">395</TD><TD>        webRuleSet.recycle();</TD></TR><TR><TD CLASS="l">396</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">397</TD><TD>        long t2=System.currentTimeMillis();</TD></TR><TR CLASS="z"><TD CLASS="l">398</TD><TD>        if (context instanceof StandardContext) {</TD></TR><TR CLASS="z"><TD CLASS="l">399</TD><TD>            ((StandardContext) context).setStartupTime(t2-t1);</TD></TR><TR><TD CLASS="l">400</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">401</TD><TD>    }</TD></TR><TR><TD CLASS="l">402</TD><TD> </TD></TR><TR><TD CLASS="l">403</TD><TD> </TD></TR><TR><TD CLASS="l">404</TD><TD>    /**</TD></TR><TR><TD CLASS="l">405</TD><TD>     * Set up an Authenticator automatically if required, and one has not</TD></TR><TR><TD CLASS="l">406</TD><TD>     * already been configured.</TD></TR><TR><TD CLASS="l"><A NAME="9">407</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">408</TD><TD>    protected synchronized void authenticatorConfig() {</TD></TR><TR><TD CLASS="l">409</TD><TD> </TD></TR><TR><TD CLASS="l">410</TD><TD>        // Does this Context require an Authenticator?</TD></TR><TR CLASS="z"><TD CLASS="l">411</TD><TD>        SecurityConstraint constraints[] = context.findConstraints();</TD></TR><TR CLASS="z"><TD CLASS="l">412</TD><TD>        if ((constraints == null) || (constraints.length == 0))</TD></TR><TR CLASS="z"><TD CLASS="l">413</TD><TD>            return;</TD></TR><TR CLASS="z"><TD CLASS="l">414</TD><TD>        LoginConfig loginConfig = context.getLoginConfig();</TD></TR><TR CLASS="z"><TD CLASS="l">415</TD><TD>        if (loginConfig == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">416</TD><TD>            loginConfig = DUMMY_LOGIN_CONFIG;</TD></TR><TR CLASS="z"><TD CLASS="l">417</TD><TD>            context.setLoginConfig(loginConfig);</TD></TR><TR><TD CLASS="l">418</TD><TD>        }</TD></TR><TR><TD CLASS="l">419</TD><TD> </TD></TR><TR><TD CLASS="l">420</TD><TD>        // Has an authenticator been configured already?</TD></TR><TR CLASS="z"><TD CLASS="l">421</TD><TD>        if (context instanceof Authenticator)</TD></TR><TR CLASS="z"><TD CLASS="l">422</TD><TD>            return;</TD></TR><TR CLASS="z"><TD CLASS="l">423</TD><TD>        if (context instanceof ContainerBase) {</TD></TR><TR CLASS="z"><TD CLASS="l">424</TD><TD>            Pipeline pipeline = ((ContainerBase) context).getPipeline();</TD></TR><TR CLASS="z"><TD CLASS="l">425</TD><TD>            if (pipeline != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">426</TD><TD>                Valve basic = pipeline.getBasic();</TD></TR><TR CLASS="z"><TD CLASS="l">427</TD><TD>                if ((basic != null) &amp;&amp; (basic instanceof Authenticator))</TD></TR><TR CLASS="z"><TD CLASS="l">428</TD><TD>                    return;</TD></TR><TR CLASS="z"><TD CLASS="l">429</TD><TD>                Valve valves[] = pipeline.getValves();</TD></TR><TR CLASS="z"><TD CLASS="l">430</TD><TD>                for (int i = 0; i &lt; valves.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">431</TD><TD>                    if (valves[i] instanceof Authenticator)</TD></TR><TR CLASS="z"><TD CLASS="l">432</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">433</TD><TD>                }</TD></TR><TR><TD CLASS="l">434</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">435</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">436</TD><TD>            return;     // Cannot install a Valve even if it would be needed</TD></TR><TR><TD CLASS="l">437</TD><TD>        }</TD></TR><TR><TD CLASS="l">438</TD><TD> </TD></TR><TR><TD CLASS="l">439</TD><TD>        // Has a Realm been configured for us to authenticate against?</TD></TR><TR CLASS="z"><TD CLASS="l">440</TD><TD>        if (context.getRealm() == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">441</TD><TD>            log.error(sm.getString(&#34;contextConfig.missingRealm&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">442</TD><TD>            ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">443</TD><TD>            return;</TD></TR><TR><TD CLASS="l">444</TD><TD>        }</TD></TR><TR><TD CLASS="l">445</TD><TD> </TD></TR><TR><TD CLASS="l">446</TD><TD>        /*</TD></TR><TR><TD CLASS="l">447</TD><TD>         * First check to see if there is a custom mapping for the login</TD></TR><TR><TD CLASS="l">448</TD><TD>         * method. If so, use it. Otherwise, check if there is a mapping in</TD></TR><TR><TD CLASS="l">449</TD><TD>         * org/apache/catalina/startup/Authenticators.properties.</TD></TR><TR><TD CLASS="l">450</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">451</TD><TD>        Valve authenticator = null;</TD></TR><TR CLASS="z"><TD CLASS="l">452</TD><TD>        if (customAuthenticators != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">453</TD><TD>            authenticator = (Valve)</TD></TR><TR CLASS="z"><TD CLASS="l">454</TD><TD>                customAuthenticators.get(loginConfig.getAuthMethod());</TD></TR><TR><TD CLASS="l">455</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">456</TD><TD>        if (authenticator == null) {</TD></TR><TR><TD CLASS="l">457</TD><TD>            // Load our mapping properties if necessary</TD></TR><TR CLASS="z"><TD CLASS="l">458</TD><TD>            if (authenticators == null) {</TD></TR><TR><TD CLASS="l">459</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">460</TD><TD>                    InputStream is=this.getClass().getClassLoader().getResourceAsStream(&#34;org/apache/catalina/startup/Authenticators.properties&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">461</TD><TD>                    if( is!=null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">462</TD><TD>                        authenticators = new Properties();</TD></TR><TR CLASS="z"><TD CLASS="l">463</TD><TD>                        authenticators.load(is);</TD></TR><TR><TD CLASS="l">464</TD><TD>                    } else {</TD></TR><TR CLASS="z"><TD CLASS="l">465</TD><TD>                        log.error(sm.getString(</TD></TR><TR><TD CLASS="l">466</TD><TD>                                &#34;contextConfig.authenticatorResources&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">467</TD><TD>                        ok=false;</TD></TR><TR CLASS="z"><TD CLASS="l">468</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">469</TD><TD>                    }</TD></TR><TR CLASS="z"><TD CLASS="l">470</TD><TD>                } catch (IOException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">471</TD><TD>                    log.error(sm.getString(</TD></TR><TR><TD CLASS="l">472</TD><TD>                                &#34;contextConfig.authenticatorResources&#34;), e);</TD></TR><TR CLASS="z"><TD CLASS="l">473</TD><TD>                    ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">474</TD><TD>                    return;</TD></TR><TR CLASS="z"><TD CLASS="l">475</TD><TD>                }</TD></TR><TR><TD CLASS="l">476</TD><TD>            }</TD></TR><TR><TD CLASS="l">477</TD><TD> </TD></TR><TR><TD CLASS="l">478</TD><TD>            // Identify the class name of the Valve we should configure</TD></TR><TR CLASS="z"><TD CLASS="l">479</TD><TD>            String authenticatorName = null;</TD></TR><TR CLASS="z"><TD CLASS="l">480</TD><TD>            authenticatorName =</TD></TR><TR CLASS="z"><TD CLASS="l">481</TD><TD>                    authenticators.getProperty(loginConfig.getAuthMethod());</TD></TR><TR CLASS="z"><TD CLASS="l">482</TD><TD>            if (authenticatorName == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">483</TD><TD>                log.error(sm.getString(&#34;contextConfig.authenticatorMissing&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">484</TD><TD>                                 loginConfig.getAuthMethod()));</TD></TR><TR CLASS="z"><TD CLASS="l">485</TD><TD>                ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">486</TD><TD>                return;</TD></TR><TR><TD CLASS="l">487</TD><TD>            }</TD></TR><TR><TD CLASS="l">488</TD><TD> </TD></TR><TR><TD CLASS="l">489</TD><TD>            // Instantiate and install an Authenticator of the requested class</TD></TR><TR><TD CLASS="l">490</TD><TD>            try {</TD></TR><TR CLASS="z"><TD CLASS="l">491</TD><TD>                Class authenticatorClass = Class.forName(authenticatorName);</TD></TR><TR CLASS="z"><TD CLASS="l">492</TD><TD>                authenticator = (Valve) authenticatorClass.newInstance();</TD></TR><TR CLASS="z"><TD CLASS="l">493</TD><TD>            } catch (Throwable t) {</TD></TR><TR CLASS="z"><TD CLASS="l">494</TD><TD>                log.error(sm.getString(</TD></TR><TR><TD CLASS="l">495</TD><TD>                                    &#34;contextConfig.authenticatorInstantiate&#34;,</TD></TR><TR><TD CLASS="l">496</TD><TD>                                    authenticatorName),</TD></TR><TR><TD CLASS="l">497</TD><TD>                          t);</TD></TR><TR CLASS="z"><TD CLASS="l">498</TD><TD>                ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">499</TD><TD>            }</TD></TR><TR><TD CLASS="l">500</TD><TD>        }</TD></TR><TR><TD CLASS="l">501</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">502</TD><TD>        if (authenticator != null &amp;&amp; context instanceof ContainerBase) {</TD></TR><TR CLASS="z"><TD CLASS="l">503</TD><TD>            Pipeline pipeline = ((ContainerBase) context).getPipeline();</TD></TR><TR CLASS="z"><TD CLASS="l">504</TD><TD>            if (pipeline != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">505</TD><TD>                ((ContainerBase) context).addValve(authenticator);</TD></TR><TR CLASS="z"><TD CLASS="l">506</TD><TD>                if (log.isDebugEnabled()) {</TD></TR><TR CLASS="z"><TD CLASS="l">507</TD><TD>                    log.debug(sm.getString(</TD></TR><TR><TD CLASS="l">508</TD><TD>                                    &#34;contextConfig.authenticatorConfigured&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">509</TD><TD>                                    loginConfig.getAuthMethod()));</TD></TR><TR><TD CLASS="l">510</TD><TD>                }</TD></TR><TR><TD CLASS="l">511</TD><TD>            }</TD></TR><TR><TD CLASS="l">512</TD><TD>        }</TD></TR><TR><TD CLASS="l">513</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">514</TD><TD>    }</TD></TR><TR><TD CLASS="l">515</TD><TD> </TD></TR><TR><TD CLASS="l">516</TD><TD> </TD></TR><TR><TD CLASS="l">517</TD><TD>    /**</TD></TR><TR><TD CLASS="l">518</TD><TD>     * Create and return a Digester configured to process the</TD></TR><TR><TD CLASS="l">519</TD><TD>     * web application deployment descriptor (web.xml).</TD></TR><TR><TD CLASS="l"><A NAME="d">520</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">521</TD><TD>    protected void createWebXmlDigester(boolean namespaceAware,</TD></TR><TR><TD CLASS="l">522</TD><TD>            boolean validation) {</TD></TR><TR><TD CLASS="l">523</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">524</TD><TD>        boolean blockExternal = context.getXmlBlockExternal();</TD></TR><TR><TD CLASS="l">525</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">526</TD><TD>        webRuleSet = new WebRuleSet();</TD></TR><TR CLASS="z"><TD CLASS="l">527</TD><TD>        webDigester = DigesterFactory.newDigester(validation,</TD></TR><TR><TD CLASS="l">528</TD><TD>                namespaceAware, webRuleSet, blockExternal);</TD></TR><TR CLASS="z"><TD CLASS="l">529</TD><TD>        webDigester.getParser();</TD></TR><TR CLASS="z"><TD CLASS="l">530</TD><TD>    }</TD></TR><TR><TD CLASS="l">531</TD><TD> </TD></TR><TR><TD CLASS="l">532</TD><TD> </TD></TR><TR><TD CLASS="l">533</TD><TD>    /**</TD></TR><TR><TD CLASS="l"><A NAME="c">534</A></TD><TD>     * Create (if necessary) and return a Digester configured to process the</TD></TR><TR><TD CLASS="l">535</TD><TD>     * context configuration descriptor for an application.</TD></TR><TR><TD CLASS="l">536</TD><TD>     */</TD></TR><TR><TD CLASS="l">537</TD><TD>    protected Digester createContextDigester() {</TD></TR><TR CLASS="z"><TD CLASS="l">538</TD><TD>        Digester digester = new Digester();</TD></TR><TR CLASS="z"><TD CLASS="l">539</TD><TD>        digester.setValidating(false);</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>        RuleSet contextRuleSet = new ContextRuleSet(&#34;&#34;, false);</TD></TR><TR CLASS="z"><TD CLASS="l">541</TD><TD>        digester.addRuleSet(contextRuleSet);</TD></TR><TR CLASS="z"><TD CLASS="l">542</TD><TD>        RuleSet namingRuleSet = new NamingRuleSet(&#34;Context/&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>        digester.addRuleSet(namingRuleSet);</TD></TR><TR CLASS="z"><TD CLASS="l">544</TD><TD>        return digester;</TD></TR><TR><TD CLASS="l"><A NAME="11">545</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">546</TD><TD> </TD></TR><TR><TD CLASS="l">547</TD><TD> </TD></TR><TR><TD CLASS="l">548</TD><TD>    protected String getBaseDir() {</TD></TR><TR CLASS="z"><TD CLASS="l">549</TD><TD>        Container engineC=context.getParent().getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">550</TD><TD>        if( engineC instanceof StandardEngine ) {</TD></TR><TR CLASS="z"><TD CLASS="l">551</TD><TD>            return ((StandardEngine)engineC).getBaseDir();</TD></TR><TR><TD CLASS="l">552</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">553</TD><TD>        return System.getProperty(&#34;catalina.base&#34;);</TD></TR><TR><TD CLASS="l">554</TD><TD>    }</TD></TR><TR><TD CLASS="l">555</TD><TD> </TD></TR><TR><TD CLASS="l">556</TD><TD>    /**</TD></TR><TR><TD CLASS="l">557</TD><TD>     * Process the default configuration file, if it exists.</TD></TR><TR><TD CLASS="l"><A NAME="e">558</A></TD><TD>     * The default config must be read with the container loader - so</TD></TR><TR><TD CLASS="l">559</TD><TD>     * container servlets can be loaded</TD></TR><TR><TD CLASS="l">560</TD><TD>     */</TD></TR><TR><TD CLASS="l">561</TD><TD>    protected void defaultWebConfig() {</TD></TR><TR CLASS="z"><TD CLASS="l">562</TD><TD>        long t1=System.currentTimeMillis();</TD></TR><TR><TD CLASS="l">563</TD><TD> </TD></TR><TR><TD CLASS="l">564</TD><TD>        // Open the default web.xml file, if it exists</TD></TR><TR CLASS="z"><TD CLASS="l">565</TD><TD>        if( defaultWebXml==null &amp;&amp; context instanceof StandardContext ) {</TD></TR><TR CLASS="z"><TD CLASS="l">566</TD><TD>            defaultWebXml=((StandardContext)context).getDefaultWebXml();</TD></TR><TR><TD CLASS="l">567</TD><TD>        }</TD></TR><TR><TD CLASS="l">568</TD><TD>        // set the default if we don't have any overrides</TD></TR><TR CLASS="z"><TD CLASS="l">569</TD><TD>        if( defaultWebXml==null ) getDefaultWebXml();</TD></TR><TR><TD CLASS="l">570</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">571</TD><TD>        File file = new File(this.defaultWebXml);</TD></TR><TR CLASS="z"><TD CLASS="l">572</TD><TD>        if (!file.isAbsolute()) {</TD></TR><TR CLASS="z"><TD CLASS="l">573</TD><TD>            file = new File(getBaseDir(),</TD></TR><TR><TD CLASS="l">574</TD><TD>                            this.defaultWebXml);</TD></TR><TR><TD CLASS="l">575</TD><TD>        }</TD></TR><TR><TD CLASS="l">576</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">577</TD><TD>        InputStream stream = null;</TD></TR><TR CLASS="z"><TD CLASS="l">578</TD><TD>        InputSource source = null;</TD></TR><TR><TD CLASS="l">579</TD><TD> </TD></TR><TR><TD CLASS="l">580</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">581</TD><TD>            if ( ! file.exists() ) {</TD></TR><TR><TD CLASS="l">582</TD><TD>                // Use getResource and getResourceAsStream</TD></TR><TR CLASS="z"><TD CLASS="l">583</TD><TD>                stream = getClass().getClassLoader()</TD></TR><TR CLASS="z"><TD CLASS="l">584</TD><TD>                    .getResourceAsStream(defaultWebXml);</TD></TR><TR CLASS="z"><TD CLASS="l">585</TD><TD>                if( stream != null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">586</TD><TD>                    source = new InputSource</TD></TR><TR CLASS="z"><TD CLASS="l">587</TD><TD>                            (getClass().getClassLoader()</TD></TR><TR CLASS="z"><TD CLASS="l">588</TD><TD>                            .getResource(defaultWebXml).toString());</TD></TR><TR><TD CLASS="l">589</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">590</TD><TD>                if( stream== null ) {</TD></TR><TR><TD CLASS="l">591</TD><TD>                    // maybe embedded</TD></TR><TR CLASS="z"><TD CLASS="l">592</TD><TD>                    stream = getClass().getClassLoader()</TD></TR><TR CLASS="z"><TD CLASS="l">593</TD><TD>                        .getResourceAsStream(&#34;web-embed.xml&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">594</TD><TD>                    if( stream != null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">595</TD><TD>                        source = new InputSource</TD></TR><TR CLASS="z"><TD CLASS="l">596</TD><TD>                        (getClass().getClassLoader()</TD></TR><TR CLASS="z"><TD CLASS="l">597</TD><TD>                                .getResource(&#34;web-embed.xml&#34;).toString());</TD></TR><TR><TD CLASS="l">598</TD><TD>                    }</TD></TR><TR><TD CLASS="l">599</TD><TD>                }</TD></TR><TR><TD CLASS="l">600</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">601</TD><TD>                if( stream== null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">602</TD><TD>                    log.info(&#34;No default web.xml&#34;);</TD></TR><TR><TD CLASS="l">603</TD><TD>                }</TD></TR><TR><TD CLASS="l">604</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">605</TD><TD>                source =</TD></TR><TR CLASS="z"><TD CLASS="l">606</TD><TD>                    new InputSource(&#34;file://&#34; + file.getAbsolutePath());</TD></TR><TR CLASS="z"><TD CLASS="l">607</TD><TD>                stream = new FileInputStream(file);</TD></TR><TR CLASS="z"><TD CLASS="l">608</TD><TD>                context.addWatchedResource(file.getAbsolutePath());</TD></TR><TR><TD CLASS="l">609</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">610</TD><TD>        } catch (Exception e) {</TD></TR><TR CLASS="z"><TD CLASS="l">611</TD><TD>            log.error(sm.getString(&#34;contextConfig.defaultMissing&#34;)</TD></TR><TR><TD CLASS="l">612</TD><TD>                      + &#34; &#34; + defaultWebXml + &#34; &#34; + file , e);</TD></TR><TR CLASS="z"><TD CLASS="l">613</TD><TD>        }</TD></TR><TR><TD CLASS="l">614</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">615</TD><TD>        if (stream != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">616</TD><TD>            processDefaultWebConfig(webDigester, stream, source);</TD></TR><TR CLASS="z"><TD CLASS="l">617</TD><TD>            webRuleSet.recycle();</TD></TR><TR><TD CLASS="l">618</TD><TD>        }</TD></TR><TR><TD CLASS="l">619</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">620</TD><TD>        long t2=System.currentTimeMillis();</TD></TR><TR CLASS="z"><TD CLASS="l">621</TD><TD>        if( (t2-t1) &gt; 200 )</TD></TR><TR CLASS="z"><TD CLASS="l">622</TD><TD>            log.debug(&#34;Processed default web.xml &#34; + file + &#34; &#34;  + ( t2-t1));</TD></TR><TR><TD CLASS="l">623</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">624</TD><TD>        stream = null;</TD></TR><TR CLASS="z"><TD CLASS="l">625</TD><TD>        source = null;</TD></TR><TR><TD CLASS="l">626</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">627</TD><TD>        String resourceName = getHostConfigPath(Constants.HostWebXml);</TD></TR><TR CLASS="z"><TD CLASS="l">628</TD><TD>        file = new File(getConfigBase(), resourceName);</TD></TR><TR><TD CLASS="l">629</TD><TD> </TD></TR><TR><TD CLASS="l">630</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">631</TD><TD>            if ( ! file.exists() ) {</TD></TR><TR><TD CLASS="l">632</TD><TD>                // Use getResource and getResourceAsStream</TD></TR><TR CLASS="z"><TD CLASS="l">633</TD><TD>                stream = getClass().getClassLoader()</TD></TR><TR CLASS="z"><TD CLASS="l">634</TD><TD>                    .getResourceAsStream(resourceName);</TD></TR><TR CLASS="z"><TD CLASS="l">635</TD><TD>                if( stream != null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">636</TD><TD>                    source = new InputSource</TD></TR><TR CLASS="z"><TD CLASS="l">637</TD><TD>                            (getClass().getClassLoader()</TD></TR><TR CLASS="z"><TD CLASS="l">638</TD><TD>                            .getResource(resourceName).toString());</TD></TR><TR><TD CLASS="l">639</TD><TD>                }</TD></TR><TR><TD CLASS="l">640</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">641</TD><TD>                source =</TD></TR><TR CLASS="z"><TD CLASS="l">642</TD><TD>                    new InputSource(&#34;file://&#34; + file.getAbsolutePath());</TD></TR><TR CLASS="z"><TD CLASS="l">643</TD><TD>                stream = new FileInputStream(file);</TD></TR><TR><TD CLASS="l">644</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">645</TD><TD>        } catch (Exception e) {</TD></TR><TR CLASS="z"><TD CLASS="l">646</TD><TD>            log.error(sm.getString(&#34;contextConfig.defaultMissing&#34;)</TD></TR><TR><TD CLASS="l">647</TD><TD>                      + &#34; &#34; + resourceName + &#34; &#34; + file , e);</TD></TR><TR CLASS="z"><TD CLASS="l">648</TD><TD>        }</TD></TR><TR><TD CLASS="l">649</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">650</TD><TD>        if (stream != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">651</TD><TD>            processDefaultWebConfig(webDigester, stream, source);</TD></TR><TR CLASS="z"><TD CLASS="l">652</TD><TD>            webRuleSet.recycle();</TD></TR><TR><TD CLASS="l">653</TD><TD>        }</TD></TR><TR><TD CLASS="l">654</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">655</TD><TD>    }</TD></TR><TR><TD CLASS="l">656</TD><TD> </TD></TR><TR><TD CLASS="l">657</TD><TD> </TD></TR><TR><TD CLASS="l">658</TD><TD>    /**</TD></TR><TR><TD CLASS="l">659</TD><TD>     * Process a default web.xml.</TD></TR><TR><TD CLASS="l"><A NAME="19">660</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">661</TD><TD>    protected void processDefaultWebConfig(Digester digester, InputStream stream,</TD></TR><TR><TD CLASS="l">662</TD><TD>            InputSource source) {</TD></TR><TR><TD CLASS="l">663</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">664</TD><TD>        if (log.isDebugEnabled())</TD></TR><TR CLASS="z"><TD CLASS="l">665</TD><TD>            log.debug(&#34;Processing context [&#34; + context.getName()</TD></TR><TR CLASS="z"><TD CLASS="l">666</TD><TD>                    + &#34;] web configuration resource &#34; + source.getSystemId());</TD></TR><TR><TD CLASS="l">667</TD><TD> </TD></TR><TR><TD CLASS="l">668</TD><TD>        // Process the default web.xml file</TD></TR><TR CLASS="z"><TD CLASS="l">669</TD><TD>        synchronized (digester) {</TD></TR><TR><TD CLASS="l">670</TD><TD>            try {</TD></TR><TR CLASS="z"><TD CLASS="l">671</TD><TD>                source.setByteStream(stream);</TD></TR><TR><TD CLASS="l">672</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">673</TD><TD>                if (context instanceof StandardContext)</TD></TR><TR CLASS="z"><TD CLASS="l">674</TD><TD>                    ((StandardContext) context).setReplaceWelcomeFiles(true);</TD></TR><TR CLASS="z"><TD CLASS="l">675</TD><TD>                digester.setClassLoader(this.getClass().getClassLoader());</TD></TR><TR CLASS="z"><TD CLASS="l">676</TD><TD>                digester.setUseContextClassLoader(false);</TD></TR><TR CLASS="z"><TD CLASS="l">677</TD><TD>                XmlErrorHandler handler = new XmlErrorHandler();</TD></TR><TR CLASS="z"><TD CLASS="l">678</TD><TD>                digester.push(context);</TD></TR><TR CLASS="z"><TD CLASS="l">679</TD><TD>                digester.setErrorHandler(handler);</TD></TR><TR CLASS="z"><TD CLASS="l">680</TD><TD>                digester.parse(source);</TD></TR><TR CLASS="z"><TD CLASS="l">681</TD><TD>                if (handler.getWarnings().size() &gt; 0 ||</TD></TR><TR CLASS="z"><TD CLASS="l">682</TD><TD>                        handler.getErrors().size() &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">683</TD><TD>                    ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">684</TD><TD>                    handler.logFindings(log, source.getSystemId());</TD></TR><TR><TD CLASS="l">685</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">686</TD><TD>            } catch (SAXParseException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">687</TD><TD>                log.error(sm.getString(&#34;contextConfig.defaultParse&#34;), e);</TD></TR><TR CLASS="z"><TD CLASS="l">688</TD><TD>                log.error(sm.getString(&#34;contextConfig.defaultPosition&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">689</TD><TD>                                 &#34;&#34; + e.getLineNumber(),</TD></TR><TR CLASS="z"><TD CLASS="l">690</TD><TD>                                 &#34;&#34; + e.getColumnNumber()));</TD></TR><TR CLASS="z"><TD CLASS="l">691</TD><TD>                ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">692</TD><TD>            } catch (Exception e) {</TD></TR><TR CLASS="z"><TD CLASS="l">693</TD><TD>                log.error(sm.getString(&#34;contextConfig.defaultParse&#34;), e);</TD></TR><TR CLASS="z"><TD CLASS="l">694</TD><TD>                ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">695</TD><TD>            } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">696</TD><TD>                digester.reset();</TD></TR><TR><TD CLASS="l">697</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">698</TD><TD>                    if (stream != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">699</TD><TD>                        stream.close();</TD></TR><TR><TD CLASS="l">700</TD><TD>                    }</TD></TR><TR CLASS="z"><TD CLASS="l">701</TD><TD>                } catch (IOException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">702</TD><TD>                    log.error(sm.getString(&#34;contextConfig.defaultClose&#34;), e);</TD></TR><TR CLASS="z"><TD CLASS="l">703</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">704</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">705</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">706</TD><TD>    }</TD></TR><TR><TD CLASS="l">707</TD><TD> </TD></TR><TR><TD CLASS="l">708</TD><TD> </TD></TR><TR><TD CLASS="l">709</TD><TD>    /**</TD></TR><TR><TD CLASS="l">710</TD><TD>     * Process the default configuration file, if it exists.</TD></TR><TR><TD CLASS="l"><A NAME="b">711</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">712</TD><TD>    protected void contextConfig() {</TD></TR><TR><TD CLASS="l">713</TD><TD> </TD></TR><TR><TD CLASS="l">714</TD><TD>        // Open the default context.xml file, if it exists</TD></TR><TR CLASS="z"><TD CLASS="l">715</TD><TD>        if( defaultContextXml==null &amp;&amp; context instanceof StandardContext ) {</TD></TR><TR CLASS="z"><TD CLASS="l">716</TD><TD>            defaultContextXml = ((StandardContext)context).getDefaultContextXml();</TD></TR><TR><TD CLASS="l">717</TD><TD>        }</TD></TR><TR><TD CLASS="l">718</TD><TD>        // set the default if we don't have any overrides</TD></TR><TR CLASS="z"><TD CLASS="l">719</TD><TD>        if( defaultContextXml==null ) getDefaultContextXml();</TD></TR><TR><TD CLASS="l">720</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">721</TD><TD>        if (!context.getOverride()) {</TD></TR><TR CLASS="z"><TD CLASS="l">722</TD><TD>            File defaultContextFile = new File(defaultContextXml);</TD></TR><TR CLASS="z"><TD CLASS="l">723</TD><TD>            if (!defaultContextFile.isAbsolute()) {</TD></TR><TR CLASS="z"><TD CLASS="l">724</TD><TD>                defaultContextFile =new File(getBaseDir(), defaultContextXml);</TD></TR><TR><TD CLASS="l">725</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">726</TD><TD>            processContextConfig(defaultContextFile.getParentFile(), defaultContextFile.getName());</TD></TR><TR CLASS="z"><TD CLASS="l">727</TD><TD>            processContextConfig(getConfigBase(), getHostConfigPath(Constants.HostContextXml));</TD></TR><TR><TD CLASS="l">728</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">729</TD><TD>        if (context.getConfigFile() != null)</TD></TR><TR CLASS="z"><TD CLASS="l">730</TD><TD>            processContextConfig(new File(context.getConfigFile()), null);</TD></TR><TR><TD CLASS="l">731</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">732</TD><TD>    }</TD></TR><TR><TD CLASS="l">733</TD><TD> </TD></TR><TR><TD CLASS="l">734</TD><TD> </TD></TR><TR><TD CLASS="l">735</TD><TD>    /**</TD></TR><TR><TD CLASS="l"><A NAME="18">736</A></TD><TD>     * Process a context.xml.</TD></TR><TR><TD CLASS="l">737</TD><TD>     */</TD></TR><TR><TD CLASS="l">738</TD><TD>    protected void processContextConfig(File baseDir, String resourceName) {</TD></TR><TR><TD CLASS="l">739</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">740</TD><TD>        if (log.isDebugEnabled())</TD></TR><TR CLASS="z"><TD CLASS="l">741</TD><TD>            log.debug(&#34;Processing context [&#34; + context.getName()</TD></TR><TR><TD CLASS="l">742</TD><TD>                    + &#34;] configuration file &#34; + baseDir + &#34; &#34; + resourceName);</TD></TR><TR><TD CLASS="l">743</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">744</TD><TD>        InputSource source = null;</TD></TR><TR CLASS="z"><TD CLASS="l">745</TD><TD>        InputStream stream = null;</TD></TR><TR><TD CLASS="l">746</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">747</TD><TD>        File file = baseDir;</TD></TR><TR CLASS="z"><TD CLASS="l">748</TD><TD>        if (resourceName != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">749</TD><TD>            file = new File(baseDir, resourceName);</TD></TR><TR><TD CLASS="l">750</TD><TD>        }</TD></TR><TR><TD CLASS="l">751</TD><TD> </TD></TR><TR><TD CLASS="l">752</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">753</TD><TD>            if ( !file.exists() ) {</TD></TR><TR CLASS="z"><TD CLASS="l">754</TD><TD>                if (resourceName != null) {</TD></TR><TR><TD CLASS="l">755</TD><TD>                    // Use getResource and getResourceAsStream</TD></TR><TR CLASS="z"><TD CLASS="l">756</TD><TD>                    stream = getClass().getClassLoader()</TD></TR><TR CLASS="z"><TD CLASS="l">757</TD><TD>                        .getResourceAsStream(resourceName);</TD></TR><TR CLASS="z"><TD CLASS="l">758</TD><TD>                    if( stream != null ) {</TD></TR><TR CLASS="z"><TD CLASS="l">759</TD><TD>                        source = new InputSource</TD></TR><TR CLASS="z"><TD CLASS="l">760</TD><TD>                            (getClass().getClassLoader()</TD></TR><TR CLASS="z"><TD CLASS="l">761</TD><TD>                            .getResource(resourceName).toString());</TD></TR><TR><TD CLASS="l">762</TD><TD>                    }</TD></TR><TR><TD CLASS="l">763</TD><TD>                }</TD></TR><TR><TD CLASS="l">764</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">765</TD><TD>                source =</TD></TR><TR CLASS="z"><TD CLASS="l">766</TD><TD>                    new InputSource(&#34;file://&#34; + file.getAbsolutePath());</TD></TR><TR CLASS="z"><TD CLASS="l">767</TD><TD>                stream = new FileInputStream(file);</TD></TR><TR><TD CLASS="l">768</TD><TD>                // Add as watched resource so that cascade reload occurs if a default</TD></TR><TR><TD CLASS="l">769</TD><TD>                // config file is modified/added/removed</TD></TR><TR CLASS="z"><TD CLASS="l">770</TD><TD>                context.addWatchedResource(file.getAbsolutePath());</TD></TR><TR><TD CLASS="l">771</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">772</TD><TD>        } catch (Exception e) {</TD></TR><TR CLASS="z"><TD CLASS="l">773</TD><TD>            log.error(sm.getString(&#34;contextConfig.contextMissing&#34;,</TD></TR><TR><TD CLASS="l">774</TD><TD>                      resourceName + &#34; &#34; + file) , e);</TD></TR><TR CLASS="z"><TD CLASS="l">775</TD><TD>        }</TD></TR><TR><TD CLASS="l">776</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">777</TD><TD>        if (source == null)</TD></TR><TR CLASS="z"><TD CLASS="l">778</TD><TD>            return;</TD></TR><TR CLASS="z"><TD CLASS="l">779</TD><TD>        synchronized (contextDigester) {</TD></TR><TR><TD CLASS="l">780</TD><TD>            try {</TD></TR><TR CLASS="z"><TD CLASS="l">781</TD><TD>                source.setByteStream(stream);</TD></TR><TR CLASS="z"><TD CLASS="l">782</TD><TD>                contextDigester.setClassLoader(this.getClass().getClassLoader());</TD></TR><TR CLASS="z"><TD CLASS="l">783</TD><TD>                contextDigester.setUseContextClassLoader(false);</TD></TR><TR CLASS="z"><TD CLASS="l">784</TD><TD>                XmlErrorHandler handler = new XmlErrorHandler();</TD></TR><TR CLASS="z"><TD CLASS="l">785</TD><TD>                contextDigester.push(context.getParent());</TD></TR><TR CLASS="z"><TD CLASS="l">786</TD><TD>                contextDigester.push(context);</TD></TR><TR CLASS="z"><TD CLASS="l">787</TD><TD>                contextDigester.setErrorHandler(handler);</TD></TR><TR CLASS="z"><TD CLASS="l">788</TD><TD>                contextDigester.parse(source);</TD></TR><TR CLASS="z"><TD CLASS="l">789</TD><TD>                if (handler.getWarnings().size() &gt; 0 ||</TD></TR><TR CLASS="z"><TD CLASS="l">790</TD><TD>                        handler.getErrors().size() &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">791</TD><TD>                    ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">792</TD><TD>                    handler.logFindings(log, source.getSystemId());</TD></TR><TR><TD CLASS="l">793</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">794</TD><TD>                if (log.isDebugEnabled())</TD></TR><TR CLASS="z"><TD CLASS="l">795</TD><TD>                    log.debug(&#34;Successfully processed context [&#34; + context.getName()</TD></TR><TR><TD CLASS="l">796</TD><TD>                            + &#34;] configuration file &#34; + baseDir + &#34; &#34; + resourceName);</TD></TR><TR CLASS="z"><TD CLASS="l">797</TD><TD>            } catch (SAXParseException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">798</TD><TD>                log.error(sm.getString(&#34;contextConfig.contextParse&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">799</TD><TD>                        context.getName()), e);</TD></TR><TR CLASS="z"><TD CLASS="l">800</TD><TD>                log.error(sm.getString(&#34;contextConfig.defaultPosition&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">801</TD><TD>                                 &#34;&#34; + e.getLineNumber(),</TD></TR><TR CLASS="z"><TD CLASS="l">802</TD><TD>                                 &#34;&#34; + e.getColumnNumber()));</TD></TR><TR CLASS="z"><TD CLASS="l">803</TD><TD>                ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">804</TD><TD>            } catch (Exception e) {</TD></TR><TR CLASS="z"><TD CLASS="l">805</TD><TD>                log.error(sm.getString(&#34;contextConfig.contextParse&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">806</TD><TD>                        context.getName()), e);</TD></TR><TR CLASS="z"><TD CLASS="l">807</TD><TD>                ok = false;</TD></TR><TR CLASS="z"><TD CLASS="l">808</TD><TD>            } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">809</TD><TD>                contextDigester.reset();</TD></TR><TR><TD CLASS="l">810</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">811</TD><TD>                    if (stream != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">812</TD><TD>                        stream.close();</TD></TR><TR><TD CLASS="l">813</TD><TD>                    }</TD></TR><TR CLASS="z"><TD CLASS="l">814</TD><TD>                } catch (IOException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">815</TD><TD>                    log.error(sm.getString(&#34;contextConfig.contextClose&#34;), e);</TD></TR><TR CLASS="z"><TD CLASS="l">816</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">817</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">818</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">819</TD><TD>    }</TD></TR><TR><TD CLASS="l">820</TD><TD> </TD></TR><TR><TD CLASS="l">821</TD><TD> </TD></TR><TR><TD CLASS="l">822</TD><TD>    /**</TD></TR><TR><TD CLASS="l">823</TD><TD>     * Adjust docBase.</TD></TR><TR><TD CLASS="l"><A NAME="10">824</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">825</TD><TD>    protected void fixDocBase()</TD></TR><TR><TD CLASS="l">826</TD><TD>        throws IOException {</TD></TR><TR><TD CLASS="l">827</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">828</TD><TD>        Host host = (Host) context.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">829</TD><TD>        String appBase = host.getAppBase();</TD></TR><TR><TD CLASS="l">830</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">831</TD><TD>        boolean unpackWARs = true;</TD></TR><TR CLASS="z"><TD CLASS="l">832</TD><TD>        if (host instanceof StandardHost) {</TD></TR><TR CLASS="z"><TD CLASS="l">833</TD><TD>            unpackWARs = ((StandardHost) host).isUnpackWARs()</TD></TR><TR CLASS="z"><TD CLASS="l">834</TD><TD>                &amp;&amp; ((StandardContext) context).getUnpackWAR();</TD></TR><TR><TD CLASS="l">835</TD><TD>        }</TD></TR><TR><TD CLASS="l">836</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">837</TD><TD>        File canonicalAppBase = new File(appBase);</TD></TR><TR CLASS="z"><TD CLASS="l">838</TD><TD>        if (canonicalAppBase.isAbsolute()) {</TD></TR><TR CLASS="z"><TD CLASS="l">839</TD><TD>            canonicalAppBase = canonicalAppBase.getCanonicalFile();</TD></TR><TR><TD CLASS="l">840</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">841</TD><TD>            canonicalAppBase =</TD></TR><TR CLASS="z"><TD CLASS="l">842</TD><TD>                new File(System.getProperty(&#34;catalina.base&#34;), appBase)</TD></TR><TR CLASS="z"><TD CLASS="l">843</TD><TD>                .getCanonicalFile();</TD></TR><TR><TD CLASS="l">844</TD><TD>        }</TD></TR><TR><TD CLASS="l">845</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">846</TD><TD>        String docBase = context.getDocBase();</TD></TR><TR CLASS="z"><TD CLASS="l">847</TD><TD>        if (docBase == null) {</TD></TR><TR><TD CLASS="l">848</TD><TD>            // Trying to guess the docBase according to the path</TD></TR><TR CLASS="z"><TD CLASS="l">849</TD><TD>            String path = context.getPath();</TD></TR><TR CLASS="z"><TD CLASS="l">850</TD><TD>            if (path == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">851</TD><TD>                return;</TD></TR><TR><TD CLASS="l">852</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">853</TD><TD>            if (path.equals(&#34;&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">854</TD><TD>                docBase = &#34;ROOT&#34;;</TD></TR><TR><TD CLASS="l">855</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">856</TD><TD>                if (path.startsWith(&#34;/&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">857</TD><TD>                    docBase = path.substring(1).replace('/', '#');</TD></TR><TR><TD CLASS="l">858</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">859</TD><TD>                    docBase = path.replace('/', '#');</TD></TR><TR><TD CLASS="l">860</TD><TD>                }</TD></TR><TR><TD CLASS="l">861</TD><TD>            }</TD></TR><TR><TD CLASS="l">862</TD><TD>        }</TD></TR><TR><TD CLASS="l">863</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">864</TD><TD>        File file = new File(docBase);</TD></TR><TR CLASS="z"><TD CLASS="l">865</TD><TD>        if (!file.isAbsolute()) {</TD></TR><TR CLASS="z"><TD CLASS="l">866</TD><TD>            docBase = (new File(canonicalAppBase, docBase)).getPath();</TD></TR><TR><TD CLASS="l">867</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">868</TD><TD>            docBase = file.getCanonicalPath();</TD></TR><TR><TD CLASS="l">869</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">870</TD><TD>        file = new File(docBase);</TD></TR><TR CLASS="z"><TD CLASS="l">871</TD><TD>        String origDocBase = docBase;</TD></TR><TR><TD CLASS="l">872</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">873</TD><TD>        String pathName = context.getPath();</TD></TR><TR CLASS="z"><TD CLASS="l">874</TD><TD>        if (pathName.equals(&#34;&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">875</TD><TD>            pathName = &#34;ROOT&#34;;</TD></TR><TR><TD CLASS="l">876</TD><TD>        } else {</TD></TR><TR><TD CLASS="l">877</TD><TD>            // Context path must start with '/'</TD></TR><TR CLASS="z"><TD CLASS="l">878</TD><TD>            pathName = pathName.substring(1).replace('/', '#');</TD></TR><TR><TD CLASS="l">879</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">880</TD><TD>        if (docBase.toLowerCase().endsWith(&#34;.war&#34;) &amp;&amp; !file.isDirectory() &amp;&amp; unpackWARs) {</TD></TR><TR CLASS="z"><TD CLASS="l">881</TD><TD>            URL war = new URL(&#34;jar:&#34; + (new File(docBase)).toURI().toURL() + &#34;!/&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">882</TD><TD>            docBase = ExpandWar.expand(host, war, pathName);</TD></TR><TR CLASS="z"><TD CLASS="l">883</TD><TD>            file = new File(docBase);</TD></TR><TR CLASS="z"><TD CLASS="l">884</TD><TD>            docBase = file.getCanonicalPath();</TD></TR><TR CLASS="z"><TD CLASS="l">885</TD><TD>            if (context instanceof StandardContext) {</TD></TR><TR CLASS="z"><TD CLASS="l">886</TD><TD>                ((StandardContext) context).setOriginalDocBase(origDocBase);</TD></TR><TR><TD CLASS="l">887</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">888</TD><TD>        } else if (docBase.toLowerCase().endsWith(&#34;.war&#34;) &amp;&amp;</TD></TR><TR CLASS="z"><TD CLASS="l">889</TD><TD>                !file.isDirectory() &amp;&amp; !unpackWARs) {</TD></TR><TR CLASS="z"><TD CLASS="l">890</TD><TD>            URL war =</TD></TR><TR CLASS="z"><TD CLASS="l">891</TD><TD>                new URL(&#34;jar:&#34; + (new File (docBase)).toURI().toURL() + &#34;!/&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">892</TD><TD>            ExpandWar.validate(host, war, pathName);</TD></TR><TR CLASS="z"><TD CLASS="l">893</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">894</TD><TD>            File docDir = new File(docBase);</TD></TR><TR CLASS="z"><TD CLASS="l">895</TD><TD>            if (!docDir.exists()) {</TD></TR><TR CLASS="z"><TD CLASS="l">896</TD><TD>                File warFile = new File(docBase + &#34;.war&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">897</TD><TD>                if (warFile.exists()) {</TD></TR><TR CLASS="z"><TD CLASS="l">898</TD><TD>                    URL war =</TD></TR><TR CLASS="z"><TD CLASS="l">899</TD><TD>                        new URL(&#34;jar:&#34; + warFile.toURI().toURL() + &#34;!/&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">900</TD><TD>                    if (unpackWARs) {</TD></TR><TR CLASS="z"><TD CLASS="l">901</TD><TD>                        docBase = ExpandWar.expand(host, war, pathName);</TD></TR><TR CLASS="z"><TD CLASS="l">902</TD><TD>                        file = new File(docBase);</TD></TR><TR CLASS="z"><TD CLASS="l">903</TD><TD>                        docBase = file.getCanonicalPath();</TD></TR><TR><TD CLASS="l">904</TD><TD>                    } else {</TD></TR><TR CLASS="z"><TD CLASS="l">905</TD><TD>                        docBase = warFile.getCanonicalPath();</TD></TR><TR CLASS="z"><TD CLASS="l">906</TD><TD>                        ExpandWar.validate(host, war, pathName);</TD></TR><TR><TD CLASS="l">907</TD><TD>                    }</TD></TR><TR><TD CLASS="l">908</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">909</TD><TD>                if (context instanceof StandardContext) {</TD></TR><TR CLASS="z"><TD CLASS="l">910</TD><TD>                    ((StandardContext) context).setOriginalDocBase(origDocBase);</TD></TR><TR><TD CLASS="l">911</TD><TD>                }</TD></TR><TR><TD CLASS="l">912</TD><TD>            }</TD></TR><TR><TD CLASS="l">913</TD><TD>        }</TD></TR><TR><TD CLASS="l">914</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">915</TD><TD>        if (docBase.startsWith(canonicalAppBase.getPath() + File.separatorChar)) {</TD></TR><TR CLASS="z"><TD CLASS="l">916</TD><TD>            docBase = docBase.substring(canonicalAppBase.getPath().length());</TD></TR><TR CLASS="z"><TD CLASS="l">917</TD><TD>            docBase = docBase.replace(File.separatorChar, '/');</TD></TR><TR CLASS="z"><TD CLASS="l">918</TD><TD>            if (docBase.startsWith(&#34;/&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">919</TD><TD>                docBase = docBase.substring(1);</TD></TR><TR><TD CLASS="l">920</TD><TD>            }</TD></TR><TR><TD CLASS="l">921</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">922</TD><TD>            docBase = docBase.replace(File.separatorChar, '/');</TD></TR><TR><TD CLASS="l">923</TD><TD>        }</TD></TR><TR><TD CLASS="l">924</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">925</TD><TD>        context.setDocBase(docBase);</TD></TR><TR><TD CLASS="l">926</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">927</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="6">928</A></TD><TD> </TD></TR><TR><TD CLASS="l">929</TD><TD> </TD></TR><TR><TD CLASS="l">930</TD><TD>    protected void antiLocking() throws IOException {</TD></TR><TR><TD CLASS="l">931</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">932</TD><TD>        if ((context instanceof StandardContext)</TD></TR><TR CLASS="z"><TD CLASS="l">933</TD><TD>            &amp;&amp; ((StandardContext) context).getAntiResourceLocking()) {</TD></TR><TR><TD CLASS="l">934</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">935</TD><TD>            Host host = (Host) context.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">936</TD><TD>            String appBase = host.getAppBase();</TD></TR><TR CLASS="z"><TD CLASS="l">937</TD><TD>            String docBase = context.getDocBase();</TD></TR><TR CLASS="z"><TD CLASS="l">938</TD><TD>            if (docBase == null)</TD></TR><TR CLASS="z"><TD CLASS="l">939</TD><TD>                return;</TD></TR><TR CLASS="z"><TD CLASS="l">940</TD><TD>            originalDocBase = docBase;</TD></TR><TR><TD CLASS="l">941</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">942</TD><TD>            File docBaseFile = new File(docBase);</TD></TR><TR CLASS="z"><TD CLASS="l">943</TD><TD>            if (!docBaseFile.isAbsolute()) {</TD></TR><TR CLASS="z"><TD CLASS="l">944</TD><TD>                File file = new File(appBase);</TD></TR><TR CLASS="z"><TD CLASS="l">945</TD><TD>                if (!file.isAbsolute()) {</TD></TR><TR CLASS="z"><TD CLASS="l">946</TD><TD>                    file = new File(System.getProperty(&#34;catalina.base&#34;), appBase);</TD></TR><TR><TD CLASS="l">947</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">948</TD><TD>                docBaseFile = new File(file, docBase);</TD></TR><TR><TD CLASS="l">949</TD><TD>            }</TD></TR><TR><TD CLASS="l">950</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">951</TD><TD>            String path = context.getPath();</TD></TR><TR CLASS="z"><TD CLASS="l">952</TD><TD>            if (path == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">953</TD><TD>                return;</TD></TR><TR><TD CLASS="l">954</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">955</TD><TD>            if (path.equals(&#34;&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">956</TD><TD>                docBase = &#34;ROOT&#34;;</TD></TR><TR><TD CLASS="l">957</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">958</TD><TD>                if (path.startsWith(&#34;/&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">959</TD><TD>                    docBase = path.substring(1).replace('/','#');</TD></TR><TR><TD CLASS="l">960</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">961</TD><TD>                    docBase = path.replace('/','#');</TD></TR><TR><TD CLASS="l">962</TD><TD>                }</TD></TR><TR><TD CLASS="l">963</TD><TD>            }</TD></TR><TR><TD CLASS="l">964</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">965</TD><TD>            if (originalDocBase.toLowerCase().endsWith(&#34;.war&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">966</TD><TD>                antiLockingDocBase = new File(</TD></TR><TR CLASS="z"><TD CLASS="l">967</TD><TD>                        System.getProperty(&#34;java.io.tmpdir&#34;),</TD></TR><TR><TD CLASS="l">968</TD><TD>                        deploymentCount++ + &#34;-&#34; + docBase + &#34;.war&#34;);</TD></TR><TR><TD CLASS="l">969</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">970</TD><TD>                antiLockingDocBase = new File(</TD></TR><TR CLASS="z"><TD CLASS="l">971</TD><TD>                        System.getProperty(&#34;java.io.tmpdir&#34;),</TD></TR><TR><TD CLASS="l">972</TD><TD>                        deploymentCount++ + &#34;-&#34; + docBase);</TD></TR><TR><TD CLASS="l">973</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">974</TD><TD>            antiLockingDocBase = antiLockingDocBase.getAbsoluteFile();</TD></TR><TR><TD CLASS="l">975</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">976</TD><TD>            if (log.isDebugEnabled())</TD></TR><TR CLASS="z"><TD CLASS="l">977</TD><TD>                log.debug(&#34;Anti locking context[&#34; + context.getPath()</TD></TR><TR><TD CLASS="l">978</TD><TD>                        + &#34;] setting docBase to &#34; +</TD></TR><TR CLASS="z"><TD CLASS="l">979</TD><TD>                        antiLockingDocBase.getPath());</TD></TR><TR><TD CLASS="l">980</TD><TD> </TD></TR><TR><TD CLASS="l">981</TD><TD>            // Cleanup just in case an old deployment is lying around</TD></TR><TR CLASS="z"><TD CLASS="l">982</TD><TD>            ExpandWar.delete(antiLockingDocBase);</TD></TR><TR CLASS="z"><TD CLASS="l">983</TD><TD>            if (ExpandWar.copy(docBaseFile, antiLockingDocBase)) {</TD></TR><TR CLASS="z"><TD CLASS="l">984</TD><TD>                context.setDocBase(antiLockingDocBase.getPath());</TD></TR><TR><TD CLASS="l">985</TD><TD>            }</TD></TR><TR><TD CLASS="l">986</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">987</TD><TD>    }</TD></TR><TR><TD CLASS="l">988</TD><TD> </TD></TR><TR><TD CLASS="l">989</TD><TD> </TD></TR><TR><TD CLASS="l">990</TD><TD>    /**</TD></TR><TR><TD CLASS="l">991</TD><TD>     * Process a &#34;init&#34; event for this Context.</TD></TR><TR><TD CLASS="l"><A NAME="16">992</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">993</TD><TD>    protected void init() {</TD></TR><TR><TD CLASS="l">994</TD><TD>        // Called from StandardContext.init()</TD></TR><TR><TD CLASS="l">995</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">996</TD><TD>        if (contextDigester == null){</TD></TR><TR CLASS="z"><TD CLASS="l">997</TD><TD>            contextDigester = createContextDigester();</TD></TR><TR CLASS="z"><TD CLASS="l">998</TD><TD>            contextDigester.getParser();</TD></TR><TR><TD CLASS="l">999</TD><TD>        }</TD></TR><TR><TD CLASS="l">1000</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1001</TD><TD>        if (log.isDebugEnabled())</TD></TR><TR CLASS="z"><TD CLASS="l">1002</TD><TD>            log.debug(sm.getString(&#34;contextConfig.init&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">1003</TD><TD>        context.setConfigured(false);</TD></TR><TR CLASS="z"><TD CLASS="l">1004</TD><TD>        ok = true;</TD></TR><TR><TD CLASS="l">1005</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1006</TD><TD>        contextConfig();</TD></TR><TR><TD CLASS="l">1007</TD><TD> </TD></TR><TR><TD CLASS="l">1008</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">1009</TD><TD>            fixDocBase();</TD></TR><TR CLASS="z"><TD CLASS="l">1010</TD><TD>        } catch (IOException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1011</TD><TD>            log.error(sm.getString(</TD></TR><TR CLASS="z"><TD CLASS="l">1012</TD><TD>                    &#34;contextConfig.fixDocBase&#34;, context.getPath()), e);</TD></TR><TR CLASS="z"><TD CLASS="l">1013</TD><TD>        }</TD></TR><TR><TD CLASS="l">1014</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1015</TD><TD>        createWebXmlDigester(context.getXmlNamespaceAware(),</TD></TR><TR CLASS="z"><TD CLASS="l">1016</TD><TD>                context.getXmlValidation());</TD></TR><TR CLASS="z"><TD CLASS="l">1017</TD><TD>    }</TD></TR><TR><TD CLASS="l">1018</TD><TD> </TD></TR><TR><TD CLASS="l">1019</TD><TD> </TD></TR><TR><TD CLASS="l">1020</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1021</TD><TD>     * Process a &#34;before start&#34; event for this Context.</TD></TR><TR><TD CLASS="l"><A NAME="a">1022</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">1023</TD><TD>    protected synchronized void beforeStart() {</TD></TR><TR><TD CLASS="l">1024</TD><TD> </TD></TR><TR><TD CLASS="l">1025</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">1026</TD><TD>            antiLocking();</TD></TR><TR CLASS="z"><TD CLASS="l">1027</TD><TD>        } catch (IOException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1028</TD><TD>            log.error(sm.getString(&#34;contextConfig.antiLocking&#34;), e);</TD></TR><TR CLASS="z"><TD CLASS="l">1029</TD><TD>        }</TD></TR><TR><TD CLASS="l">1030</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1031</TD><TD>    }</TD></TR><TR><TD CLASS="l">1032</TD><TD> </TD></TR><TR><TD CLASS="l">1033</TD><TD> </TD></TR><TR><TD CLASS="l">1034</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1035</TD><TD>     * Process a &#34;start&#34; event for this Context.</TD></TR><TR><TD CLASS="l"><A NAME="1d">1036</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">1037</TD><TD>    protected synchronized void start() {</TD></TR><TR><TD CLASS="l">1038</TD><TD>        // Called from StandardContext.start()</TD></TR><TR><TD CLASS="l">1039</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1040</TD><TD>        if (log.isDebugEnabled())</TD></TR><TR CLASS="z"><TD CLASS="l">1041</TD><TD>            log.debug(sm.getString(&#34;contextConfig.start&#34;));</TD></TR><TR><TD CLASS="l">1042</TD><TD> </TD></TR><TR><TD CLASS="l">1043</TD><TD>        // Process the default and application web.xml files</TD></TR><TR CLASS="z"><TD CLASS="l">1044</TD><TD>        defaultWebConfig();</TD></TR><TR CLASS="z"><TD CLASS="l">1045</TD><TD>        applicationWebConfig();</TD></TR><TR CLASS="z"><TD CLASS="l">1046</TD><TD>        if (!context.getIgnoreAnnotations()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1047</TD><TD>            applicationAnnotationsConfig();</TD></TR><TR><TD CLASS="l">1048</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1049</TD><TD>        if (ok) {</TD></TR><TR CLASS="z"><TD CLASS="l">1050</TD><TD>            validateSecurityRoles();</TD></TR><TR><TD CLASS="l">1051</TD><TD>        }</TD></TR><TR><TD CLASS="l">1052</TD><TD> </TD></TR><TR><TD CLASS="l">1053</TD><TD>        // Configure an authenticator if we need one</TD></TR><TR CLASS="z"><TD CLASS="l">1054</TD><TD>        if (ok)</TD></TR><TR CLASS="z"><TD CLASS="l">1055</TD><TD>            authenticatorConfig();</TD></TR><TR><TD CLASS="l">1056</TD><TD> </TD></TR><TR><TD CLASS="l">1057</TD><TD>        // Dump the contents of this pipeline if requested</TD></TR><TR CLASS="z"><TD CLASS="l">1058</TD><TD>        if ((log.isDebugEnabled()) &amp;&amp; (context instanceof ContainerBase)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1059</TD><TD>            log.debug(&#34;Pipeline Configuration:&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1060</TD><TD>            Pipeline pipeline = ((ContainerBase) context).getPipeline();</TD></TR><TR CLASS="z"><TD CLASS="l">1061</TD><TD>            Valve valves[] = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1062</TD><TD>            if (pipeline != null)</TD></TR><TR CLASS="z"><TD CLASS="l">1063</TD><TD>                valves = pipeline.getValves();</TD></TR><TR CLASS="z"><TD CLASS="l">1064</TD><TD>            if (valves != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1065</TD><TD>                for (int i = 0; i &lt; valves.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1066</TD><TD>                    log.debug(&#34;  &#34; + valves[i].getInfo());</TD></TR><TR><TD CLASS="l">1067</TD><TD>                }</TD></TR><TR><TD CLASS="l">1068</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1069</TD><TD>            log.debug(&#34;======================&#34;);</TD></TR><TR><TD CLASS="l">1070</TD><TD>        }</TD></TR><TR><TD CLASS="l">1071</TD><TD> </TD></TR><TR><TD CLASS="l">1072</TD><TD>        // Make our application available if no problems were encountered</TD></TR><TR CLASS="z"><TD CLASS="l">1073</TD><TD>        if (ok)</TD></TR><TR CLASS="z"><TD CLASS="l">1074</TD><TD>            context.setConfigured(true);</TD></TR><TR><TD CLASS="l">1075</TD><TD>        else {</TD></TR><TR CLASS="z"><TD CLASS="l">1076</TD><TD>            log.error(sm.getString(&#34;contextConfig.unavailable&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">1077</TD><TD>            context.setConfigured(false);</TD></TR><TR><TD CLASS="l">1078</TD><TD>        }</TD></TR><TR><TD CLASS="l">1079</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1080</TD><TD>    }</TD></TR><TR><TD CLASS="l">1081</TD><TD> </TD></TR><TR><TD CLASS="l">1082</TD><TD> </TD></TR><TR><TD CLASS="l">1083</TD><TD>    /**</TD></TR><TR><TD CLASS="l"><A NAME="1e">1084</A></TD><TD>     * Process a &#34;stop&#34; event for this Context.</TD></TR><TR><TD CLASS="l">1085</TD><TD>     */</TD></TR><TR><TD CLASS="l">1086</TD><TD>    protected synchronized void stop() {</TD></TR><TR><TD CLASS="l">1087</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1088</TD><TD>        if (log.isDebugEnabled())</TD></TR><TR CLASS="z"><TD CLASS="l">1089</TD><TD>            log.debug(sm.getString(&#34;contextConfig.stop&#34;));</TD></TR><TR><TD CLASS="l">1090</TD><TD> </TD></TR><TR><TD CLASS="l">1091</TD><TD>        int i;</TD></TR><TR><TD CLASS="l">1092</TD><TD> </TD></TR><TR><TD CLASS="l">1093</TD><TD>        // Removing children</TD></TR><TR CLASS="z"><TD CLASS="l">1094</TD><TD>        Container[] children = context.findChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">1095</TD><TD>        for (i = 0; i &lt; children.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1096</TD><TD>            context.removeChild(children[i]);</TD></TR><TR><TD CLASS="l">1097</TD><TD>        }</TD></TR><TR><TD CLASS="l">1098</TD><TD> </TD></TR><TR><TD CLASS="l">1099</TD><TD>        // Removing application parameters</TD></TR><TR><TD CLASS="l">1100</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1101</TD><TD>        ApplicationParameter[] applicationParameters =</TD></TR><TR><TD CLASS="l">1102</TD><TD>            context.findApplicationParameters();</TD></TR><TR><TD CLASS="l">1103</TD><TD>        for (i = 0; i &lt; applicationParameters.length; i++) {</TD></TR><TR><TD CLASS="l">1104</TD><TD>            context.removeApplicationParameter</TD></TR><TR><TD CLASS="l">1105</TD><TD>                (applicationParameters[i].getName());</TD></TR><TR><TD CLASS="l">1106</TD><TD>        }</TD></TR><TR><TD CLASS="l">1107</TD><TD>        */</TD></TR><TR><TD CLASS="l">1108</TD><TD> </TD></TR><TR><TD CLASS="l">1109</TD><TD>        // Removing security constraints</TD></TR><TR CLASS="z"><TD CLASS="l">1110</TD><TD>        SecurityConstraint[] securityConstraints = context.findConstraints();</TD></TR><TR CLASS="z"><TD CLASS="l">1111</TD><TD>        for (i = 0; i &lt; securityConstraints.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1112</TD><TD>            context.removeConstraint(securityConstraints[i]);</TD></TR><TR><TD CLASS="l">1113</TD><TD>        }</TD></TR><TR><TD CLASS="l">1114</TD><TD> </TD></TR><TR><TD CLASS="l">1115</TD><TD>        // Removing Ejbs</TD></TR><TR><TD CLASS="l">1116</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1117</TD><TD>        ContextEjb[] contextEjbs = context.findEjbs();</TD></TR><TR><TD CLASS="l">1118</TD><TD>        for (i = 0; i &lt; contextEjbs.length; i++) {</TD></TR><TR><TD CLASS="l">1119</TD><TD>            context.removeEjb(contextEjbs[i].getName());</TD></TR><TR><TD CLASS="l">1120</TD><TD>        }</TD></TR><TR><TD CLASS="l">1121</TD><TD>        */</TD></TR><TR><TD CLASS="l">1122</TD><TD> </TD></TR><TR><TD CLASS="l">1123</TD><TD>        // Removing environments</TD></TR><TR><TD CLASS="l">1124</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1125</TD><TD>        ContextEnvironment[] contextEnvironments = context.findEnvironments();</TD></TR><TR><TD CLASS="l">1126</TD><TD>        for (i = 0; i &lt; contextEnvironments.length; i++) {</TD></TR><TR><TD CLASS="l">1127</TD><TD>            context.removeEnvironment(contextEnvironments[i].getName());</TD></TR><TR><TD CLASS="l">1128</TD><TD>        }</TD></TR><TR><TD CLASS="l">1129</TD><TD>        */</TD></TR><TR><TD CLASS="l">1130</TD><TD> </TD></TR><TR><TD CLASS="l">1131</TD><TD>        // Removing errors pages</TD></TR><TR CLASS="z"><TD CLASS="l">1132</TD><TD>        ErrorPage[] errorPages = context.findErrorPages();</TD></TR><TR CLASS="z"><TD CLASS="l">1133</TD><TD>        for (i = 0; i &lt; errorPages.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1134</TD><TD>            context.removeErrorPage(errorPages[i]);</TD></TR><TR><TD CLASS="l">1135</TD><TD>        }</TD></TR><TR><TD CLASS="l">1136</TD><TD> </TD></TR><TR><TD CLASS="l">1137</TD><TD>        // Removing filter defs</TD></TR><TR CLASS="z"><TD CLASS="l">1138</TD><TD>        FilterDef[] filterDefs = context.findFilterDefs();</TD></TR><TR CLASS="z"><TD CLASS="l">1139</TD><TD>        for (i = 0; i &lt; filterDefs.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1140</TD><TD>            context.removeFilterDef(filterDefs[i]);</TD></TR><TR><TD CLASS="l">1141</TD><TD>        }</TD></TR><TR><TD CLASS="l">1142</TD><TD> </TD></TR><TR><TD CLASS="l">1143</TD><TD>        // Removing filter maps</TD></TR><TR CLASS="z"><TD CLASS="l">1144</TD><TD>        FilterMap[] filterMaps = context.findFilterMaps();</TD></TR><TR CLASS="z"><TD CLASS="l">1145</TD><TD>        for (i = 0; i &lt; filterMaps.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1146</TD><TD>            context.removeFilterMap(filterMaps[i]);</TD></TR><TR><TD CLASS="l">1147</TD><TD>        }</TD></TR><TR><TD CLASS="l">1148</TD><TD> </TD></TR><TR><TD CLASS="l">1149</TD><TD>        // Removing local ejbs</TD></TR><TR><TD CLASS="l">1150</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1151</TD><TD>        ContextLocalEjb[] contextLocalEjbs = context.findLocalEjbs();</TD></TR><TR><TD CLASS="l">1152</TD><TD>        for (i = 0; i &lt; contextLocalEjbs.length; i++) {</TD></TR><TR><TD CLASS="l">1153</TD><TD>            context.removeLocalEjb(contextLocalEjbs[i].getName());</TD></TR><TR><TD CLASS="l">1154</TD><TD>        }</TD></TR><TR><TD CLASS="l">1155</TD><TD>        */</TD></TR><TR><TD CLASS="l">1156</TD><TD> </TD></TR><TR><TD CLASS="l">1157</TD><TD>        // Removing Mime mappings</TD></TR><TR CLASS="z"><TD CLASS="l">1158</TD><TD>        String[] mimeMappings = context.findMimeMappings();</TD></TR><TR CLASS="z"><TD CLASS="l">1159</TD><TD>        for (i = 0; i &lt; mimeMappings.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1160</TD><TD>            context.removeMimeMapping(mimeMappings[i]);</TD></TR><TR><TD CLASS="l">1161</TD><TD>        }</TD></TR><TR><TD CLASS="l">1162</TD><TD> </TD></TR><TR><TD CLASS="l">1163</TD><TD>        // Removing parameters</TD></TR><TR CLASS="z"><TD CLASS="l">1164</TD><TD>        String[] parameters = context.findParameters();</TD></TR><TR CLASS="z"><TD CLASS="l">1165</TD><TD>        for (i = 0; i &lt; parameters.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1166</TD><TD>            context.removeParameter(parameters[i]);</TD></TR><TR><TD CLASS="l">1167</TD><TD>        }</TD></TR><TR><TD CLASS="l">1168</TD><TD> </TD></TR><TR><TD CLASS="l">1169</TD><TD>        // Removing resource env refs</TD></TR><TR><TD CLASS="l">1170</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1171</TD><TD>        String[] resourceEnvRefs = context.findResourceEnvRefs();</TD></TR><TR><TD CLASS="l">1172</TD><TD>        for (i = 0; i &lt; resourceEnvRefs.length; i++) {</TD></TR><TR><TD CLASS="l">1173</TD><TD>            context.removeResourceEnvRef(resourceEnvRefs[i]);</TD></TR><TR><TD CLASS="l">1174</TD><TD>        }</TD></TR><TR><TD CLASS="l">1175</TD><TD>        */</TD></TR><TR><TD CLASS="l">1176</TD><TD> </TD></TR><TR><TD CLASS="l">1177</TD><TD>        // Removing resource links</TD></TR><TR><TD CLASS="l">1178</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1179</TD><TD>        ContextResourceLink[] contextResourceLinks =</TD></TR><TR><TD CLASS="l">1180</TD><TD>            context.findResourceLinks();</TD></TR><TR><TD CLASS="l">1181</TD><TD>        for (i = 0; i &lt; contextResourceLinks.length; i++) {</TD></TR><TR><TD CLASS="l">1182</TD><TD>            context.removeResourceLink(contextResourceLinks[i].getName());</TD></TR><TR><TD CLASS="l">1183</TD><TD>        }</TD></TR><TR><TD CLASS="l">1184</TD><TD>        */</TD></TR><TR><TD CLASS="l">1185</TD><TD> </TD></TR><TR><TD CLASS="l">1186</TD><TD>        // Removing resources</TD></TR><TR><TD CLASS="l">1187</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1188</TD><TD>        ContextResource[] contextResources = context.findResources();</TD></TR><TR><TD CLASS="l">1189</TD><TD>        for (i = 0; i &lt; contextResources.length; i++) {</TD></TR><TR><TD CLASS="l">1190</TD><TD>            context.removeResource(contextResources[i].getName());</TD></TR><TR><TD CLASS="l">1191</TD><TD>        }</TD></TR><TR><TD CLASS="l">1192</TD><TD>        */</TD></TR><TR><TD CLASS="l">1193</TD><TD> </TD></TR><TR><TD CLASS="l">1194</TD><TD>        // Removing security role</TD></TR><TR CLASS="z"><TD CLASS="l">1195</TD><TD>        String[] securityRoles = context.findSecurityRoles();</TD></TR><TR CLASS="z"><TD CLASS="l">1196</TD><TD>        for (i = 0; i &lt; securityRoles.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1197</TD><TD>            context.removeSecurityRole(securityRoles[i]);</TD></TR><TR><TD CLASS="l">1198</TD><TD>        }</TD></TR><TR><TD CLASS="l">1199</TD><TD> </TD></TR><TR><TD CLASS="l">1200</TD><TD>        // Removing servlet mappings</TD></TR><TR CLASS="z"><TD CLASS="l">1201</TD><TD>        String[] servletMappings = context.findServletMappings();</TD></TR><TR CLASS="z"><TD CLASS="l">1202</TD><TD>        for (i = 0; i &lt; servletMappings.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1203</TD><TD>            context.removeServletMapping(servletMappings[i]);</TD></TR><TR><TD CLASS="l">1204</TD><TD>        }</TD></TR><TR><TD CLASS="l">1205</TD><TD> </TD></TR><TR><TD CLASS="l">1206</TD><TD>        // FIXME : Removing status pages</TD></TR><TR><TD CLASS="l">1207</TD><TD> </TD></TR><TR><TD CLASS="l">1208</TD><TD>        // Removing taglibs</TD></TR><TR CLASS="z"><TD CLASS="l">1209</TD><TD>        String[] taglibs = context.findTaglibs();</TD></TR><TR CLASS="z"><TD CLASS="l">1210</TD><TD>        for (i = 0; i &lt; taglibs.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1211</TD><TD>            context.removeTaglib(taglibs[i]);</TD></TR><TR><TD CLASS="l">1212</TD><TD>        }</TD></TR><TR><TD CLASS="l">1213</TD><TD> </TD></TR><TR><TD CLASS="l">1214</TD><TD>        // Removing welcome files</TD></TR><TR CLASS="z"><TD CLASS="l">1215</TD><TD>        String[] welcomeFiles = context.findWelcomeFiles();</TD></TR><TR CLASS="z"><TD CLASS="l">1216</TD><TD>        for (i = 0; i &lt; welcomeFiles.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1217</TD><TD>            context.removeWelcomeFile(welcomeFiles[i]);</TD></TR><TR><TD CLASS="l">1218</TD><TD>        }</TD></TR><TR><TD CLASS="l">1219</TD><TD> </TD></TR><TR><TD CLASS="l">1220</TD><TD>        // Removing wrapper lifecycles</TD></TR><TR CLASS="z"><TD CLASS="l">1221</TD><TD>        String[] wrapperLifecycles = context.findWrapperLifecycles();</TD></TR><TR CLASS="z"><TD CLASS="l">1222</TD><TD>        for (i = 0; i &lt; wrapperLifecycles.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1223</TD><TD>            context.removeWrapperLifecycle(wrapperLifecycles[i]);</TD></TR><TR><TD CLASS="l">1224</TD><TD>        }</TD></TR><TR><TD CLASS="l">1225</TD><TD> </TD></TR><TR><TD CLASS="l">1226</TD><TD>        // Removing wrapper listeners</TD></TR><TR CLASS="z"><TD CLASS="l">1227</TD><TD>        String[] wrapperListeners = context.findWrapperListeners();</TD></TR><TR CLASS="z"><TD CLASS="l">1228</TD><TD>        for (i = 0; i &lt; wrapperListeners.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1229</TD><TD>            context.removeWrapperListener(wrapperListeners[i]);</TD></TR><TR><TD CLASS="l">1230</TD><TD>        }</TD></TR><TR><TD CLASS="l">1231</TD><TD> </TD></TR><TR><TD CLASS="l">1232</TD><TD>        // Remove (partially) folders and files created by antiLocking</TD></TR><TR CLASS="z"><TD CLASS="l">1233</TD><TD>        if (antiLockingDocBase != null) {</TD></TR><TR><TD CLASS="l">1234</TD><TD>            // No need to log failure - it is expected in this case</TD></TR><TR CLASS="z"><TD CLASS="l">1235</TD><TD>            ExpandWar.delete(antiLockingDocBase, false);</TD></TR><TR><TD CLASS="l">1236</TD><TD>        }</TD></TR><TR><TD CLASS="l">1237</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1238</TD><TD>        ok = true;</TD></TR><TR><TD CLASS="l">1239</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1240</TD><TD>    }</TD></TR><TR><TD CLASS="l">1241</TD><TD> </TD></TR><TR><TD CLASS="l">1242</TD><TD> </TD></TR><TR><TD CLASS="l">1243</TD><TD>    /**</TD></TR><TR><TD CLASS="l"><A NAME="f">1244</A></TD><TD>     * Process a &#34;destroy&#34; event for this Context.</TD></TR><TR><TD CLASS="l">1245</TD><TD>     */</TD></TR><TR><TD CLASS="l">1246</TD><TD>    protected synchronized void destroy() {</TD></TR><TR><TD CLASS="l">1247</TD><TD>        // Called from StandardContext.destroy()</TD></TR><TR CLASS="z"><TD CLASS="l">1248</TD><TD>        if (log.isDebugEnabled())</TD></TR><TR CLASS="z"><TD CLASS="l">1249</TD><TD>            log.debug(sm.getString(&#34;contextConfig.destroy&#34;));</TD></TR><TR><TD CLASS="l">1250</TD><TD> </TD></TR><TR><TD CLASS="l">1251</TD><TD>        // Changed to getWorkPath per Bugzilla 35819.</TD></TR><TR CLASS="z"><TD CLASS="l">1252</TD><TD>        String workDir = ((StandardContext) context).getWorkPath();</TD></TR><TR CLASS="z"><TD CLASS="l">1253</TD><TD>        if (workDir != null)</TD></TR><TR CLASS="z"><TD CLASS="l">1254</TD><TD>            ExpandWar.delete(new File(workDir));</TD></TR><TR CLASS="z"><TD CLASS="l">1255</TD><TD>    }</TD></TR><TR><TD CLASS="l">1256</TD><TD> </TD></TR><TR><TD CLASS="l">1257</TD><TD> </TD></TR><TR><TD CLASS="l">1258</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1259</TD><TD>     * Validate the usage of security role names in the web application</TD></TR><TR><TD CLASS="l">1260</TD><TD>     * deployment descriptor.  If any problems are found, issue warning</TD></TR><TR><TD CLASS="l">1261</TD><TD>     * messages (for backwards compatibility) and add the missing roles.</TD></TR><TR><TD CLASS="l">1262</TD><TD>     * (To make these problems fatal instead, simply set the &lt;code&gt;ok&lt;/code&gt;</TD></TR><TR><TD CLASS="l">1263</TD><TD>     * instance variable to &lt;code&gt;false&lt;/code&gt; as well).</TD></TR><TR><TD CLASS="l"><A NAME="1f">1264</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">1265</TD><TD>    protected void validateSecurityRoles() {</TD></TR><TR><TD CLASS="l">1266</TD><TD> </TD></TR><TR><TD CLASS="l">1267</TD><TD>        // Check role names used in &lt;security-constraint&gt; elements</TD></TR><TR CLASS="z"><TD CLASS="l">1268</TD><TD>        SecurityConstraint constraints[] = context.findConstraints();</TD></TR><TR CLASS="z"><TD CLASS="l">1269</TD><TD>        for (int i = 0; i &lt; constraints.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1270</TD><TD>            String roles[] = constraints[i].findAuthRoles();</TD></TR><TR CLASS="z"><TD CLASS="l">1271</TD><TD>            for (int j = 0; j &lt; roles.length; j++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1272</TD><TD>                if (!&#34;*&#34;.equals(roles[j]) &amp;&amp;</TD></TR><TR CLASS="z"><TD CLASS="l">1273</TD><TD>                    !context.findSecurityRole(roles[j])) {</TD></TR><TR CLASS="z"><TD CLASS="l">1274</TD><TD>                    log.warn(sm.getString(&#34;contextConfig.role.auth&#34;, roles[j]));</TD></TR><TR CLASS="z"><TD CLASS="l">1275</TD><TD>                    context.addSecurityRole(roles[j]);</TD></TR><TR><TD CLASS="l">1276</TD><TD>                }</TD></TR><TR><TD CLASS="l">1277</TD><TD>            }</TD></TR><TR><TD CLASS="l">1278</TD><TD>        }</TD></TR><TR><TD CLASS="l">1279</TD><TD> </TD></TR><TR><TD CLASS="l">1280</TD><TD>        // Check role names used in &lt;servlet&gt; elements</TD></TR><TR CLASS="z"><TD CLASS="l">1281</TD><TD>        Container wrappers[] = context.findChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">1282</TD><TD>        for (int i = 0; i &lt; wrappers.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1283</TD><TD>            Wrapper wrapper = (Wrapper) wrappers[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1284</TD><TD>            String runAs = wrapper.getRunAs();</TD></TR><TR CLASS="z"><TD CLASS="l">1285</TD><TD>            if ((runAs != null) &amp;&amp; !context.findSecurityRole(runAs)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1286</TD><TD>                log.warn(sm.getString(&#34;contextConfig.role.runas&#34;, runAs));</TD></TR><TR CLASS="z"><TD CLASS="l">1287</TD><TD>                context.addSecurityRole(runAs);</TD></TR><TR><TD CLASS="l">1288</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1289</TD><TD>            String names[] = wrapper.findSecurityReferences();</TD></TR><TR CLASS="z"><TD CLASS="l">1290</TD><TD>            for (int j = 0; j &lt; names.length; j++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1291</TD><TD>                String link = wrapper.findSecurityReference(names[j]);</TD></TR><TR CLASS="z"><TD CLASS="l">1292</TD><TD>                if ((link != null) &amp;&amp; !context.findSecurityRole(link)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1293</TD><TD>                    log.warn(sm.getString(&#34;contextConfig.role.link&#34;, link));</TD></TR><TR CLASS="z"><TD CLASS="l">1294</TD><TD>                    context.addSecurityRole(link);</TD></TR><TR><TD CLASS="l">1295</TD><TD>                }</TD></TR><TR><TD CLASS="l">1296</TD><TD>            }</TD></TR><TR><TD CLASS="l">1297</TD><TD>        }</TD></TR><TR><TD CLASS="l">1298</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1299</TD><TD>    }</TD></TR><TR><TD CLASS="l">1300</TD><TD> </TD></TR><TR><TD CLASS="l">1301</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="12">1302</A></TD><TD>    /**</TD></TR><TR><TD CLASS="l">1303</TD><TD>     * Get config base.</TD></TR><TR><TD CLASS="l">1304</TD><TD>     */</TD></TR><TR><TD CLASS="l">1305</TD><TD>    protected File getConfigBase() {</TD></TR><TR CLASS="z"><TD CLASS="l">1306</TD><TD>        File configBase =</TD></TR><TR CLASS="z"><TD CLASS="l">1307</TD><TD>            new File(System.getProperty(&#34;catalina.base&#34;), &#34;conf&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1308</TD><TD>        if (!configBase.exists()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1309</TD><TD>            return null;</TD></TR><TR><TD CLASS="l">1310</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1311</TD><TD>            return configBase;</TD></TR><TR><TD CLASS="l">1312</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="15">1313</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1314</TD><TD> </TD></TR><TR><TD CLASS="l">1315</TD><TD> </TD></TR><TR><TD CLASS="l">1316</TD><TD>    protected String getHostConfigPath(String resourceName) {</TD></TR><TR CLASS="z"><TD CLASS="l">1317</TD><TD>        StringBuffer result = new StringBuffer();</TD></TR><TR CLASS="z"><TD CLASS="l">1318</TD><TD>        Container container = context;</TD></TR><TR CLASS="z"><TD CLASS="l">1319</TD><TD>        Container host = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1320</TD><TD>        Container engine = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1321</TD><TD>        while (container != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1322</TD><TD>            if (container instanceof Host)</TD></TR><TR CLASS="z"><TD CLASS="l">1323</TD><TD>                host = container;</TD></TR><TR CLASS="z"><TD CLASS="l">1324</TD><TD>            if (container instanceof Engine)</TD></TR><TR CLASS="z"><TD CLASS="l">1325</TD><TD>                engine = container;</TD></TR><TR CLASS="z"><TD CLASS="l">1326</TD><TD>            container = container.getParent();</TD></TR><TR><TD CLASS="l">1327</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1328</TD><TD>        if (engine != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1329</TD><TD>            result.append(engine.getName()).append('/');</TD></TR><TR><TD CLASS="l">1330</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1331</TD><TD>        if (host != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1332</TD><TD>            result.append(host.getName()).append('/');</TD></TR><TR><TD CLASS="l">1333</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1334</TD><TD>        result.append(resourceName);</TD></TR><TR CLASS="z"><TD CLASS="l">1335</TD><TD>        return result.toString();</TD></TR><TR><TD CLASS="l">1336</TD><TD>    }</TD></TR><TR><TD CLASS="l">1337</TD><TD> </TD></TR><TR><TD CLASS="l">1338</TD><TD> </TD></TR><TR><TD CLASS="l">1339</TD><TD>    /**</TD></TR><TR><TD CLASS="l"><A NAME="0">1340</A></TD><TD>     * @deprecated Unused. Use {@link XmlErrorHandler}. Will be removed in</TD></TR><TR><TD CLASS="l">1341</TD><TD>     *             Tomcat 7.0.x</TD></TR><TR><TD CLASS="l">1342</TD><TD>     */</TD></TR><TR><TD CLASS="l">1343</TD><TD>    @Deprecated</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2">1344</A></TD><TD>    protected class ContextErrorHandler</TD></TR><TR><TD CLASS="l">1345</TD><TD>        implements ErrorHandler {</TD></TR><TR><TD CLASS="l">1346</TD><TD> </TD></TR><TR><TD CLASS="l">1347</TD><TD>        public void error(SAXParseException exception) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3">1348</A></TD><TD>            parseException = exception;</TD></TR><TR CLASS="z"><TD CLASS="l">1349</TD><TD>        }</TD></TR><TR><TD CLASS="l">1350</TD><TD> </TD></TR><TR><TD CLASS="l">1351</TD><TD>        public void fatalError(SAXParseException exception) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="4">1352</A></TD><TD>            parseException = exception;</TD></TR><TR CLASS="z"><TD CLASS="l">1353</TD><TD>        }</TD></TR><TR><TD CLASS="l">1354</TD><TD> </TD></TR><TR><TD CLASS="l">1355</TD><TD>        public void warning(SAXParseException exception) {</TD></TR><TR CLASS="z"><TD CLASS="l">1356</TD><TD>            parseException = exception;</TD></TR><TR CLASS="z"><TD CLASS="l">1357</TD><TD>        }</TD></TR><TR><TD CLASS="l">1358</TD><TD> </TD></TR><TR><TD CLASS="l">1359</TD><TD>    }</TD></TR><TR><TD CLASS="l">1360</TD><TD> </TD></TR><TR><TD CLASS="l">1361</TD><TD>}</TD></TR></TABLE><P></P><TABLE WIDTH="100%" CLASS="hdft" CELLSPACING="0"><TR><TD CLASS="nv">[<A HREF="../index.html">all classes</A>][<A HREF="38.html">org.apache.catalina.startup</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://sourceforge.net/projects/emma">EMMA 2.1.5320 (stable)</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>